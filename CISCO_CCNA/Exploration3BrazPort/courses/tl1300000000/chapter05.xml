<chapter type="" id="tl1305000000">
<title><content-text>STP</content-text></title>
<section type="ChapterIntroduction" id="tl1305000000">
<title><content-text>Introdução do capítulo</content-text></title>
<topic type="" id="tl1305000100">
<title><content-text>Introdução</content-text></title>
<page type="OneColumn" id="tl1305000101">
<content-media type="ChapterIntroduction" id="cm8716362792">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305000000/tl1305000100/tl1305000101/cm8716362792.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305000000/tl1305000100/tl1305000101/cm8716362792text.xml"/></content-media>
<content-text><p>As redes de computadores são, evidentemente, componentes críticos da maioria dos pequenos e médios negócios. Consequentemente, os administradores de TI têm que implementar a redundância em suas redes hierárquicas. Entretanto, adicionar links extras aos switches e roteadores na rede introduz loops de tráfego que precisam ser gerenciados de uma forma dinâmica: quando uma conexão de switch é perdida, outro link precisa assumir seu lugar rapidamente sem introduzir novos <content-link target="{0DE28A74-DFF2-4B0B-8CA6-0FAD549CD488}" type="glossary">loops</content-link> de tráfego. Neste capítulo, você aprenderá como o protocolo spanning tree (<content-link target="{8776D853-1CAD-4943-AEA4-BC2E928BA0BF}" type="glossary">STP</content-link>, Spanning Tree Protocol) impede problemas de loop na rede e como o STP evoluiu para um protocolo que calcula rapidamente quais portas devem ser bloqueadas de forma que uma rede baseada em VLAN seja mantida livre de loops de tráfego.</p></content-text>
</page>
</topic>
</section>
<section type="" id="tl1305010000">
<title><content-text>Topologias redundantes de camada 2</content-text></title>
<topic type="" id="tl1305010100">
<title><content-text>Redundância</content-text></title>
<page type="OneColumn" id="tl1305010101">
<content-media type="AnimationPartialScreen" id="cm9869081782">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010100/tl1305010101/cm9869081782.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010100/tl1305010101/cm9869081782text.xml"/></content-media>
<content-text><p><b>Redundância em uma rede hierárquica</b></p> <p>O modelo de design hierárquico foi apresentado no Capítulo 1. Este modelo abrange os problemas encontrados nas topologias de rede do modelo plano. Um dos problemas é a redundância. A redundância de camada 2 aprimora a disponibilidade da rede implementando caminhos alternativos através da adição de equipamentos e cabeamento.Possuir diversos caminhos para que os dados atravessem a rede permite que ocorra a interrupção de um deles sem que haja impacto sobre a conectividade dos dispositivos na rede.</p> <p>Como você pode ver na animação:</p> <p>1. O PC1 está se comunicando com PC4 em uma topologia de rede configurada de forma redundante.</p> <p>2. Quando o link de rede entre o switch S1 e o switch S2 é interrompido, o caminho entre PC1 e PC4 é automaticamente ajustado para compensar a interrupção. </p> <p>3. Quando a conexão de rede entre S1 e S2 é restaurada, o caminho é reajustado para rotear o tráfego diretamente de S2 através de S1 para chegar ao PC4.</p> <p>Como os negócios tornam-se cada vez mais dependentes da rede, a disponibilidade da infra-estrutura de rede se torna uma preocupação crítica e isso deve ser resolvido. A redundância é a solução para obter a disponibilidade necessária.</p></content-text>
</page>
<page type="OneColumn" id="tl1305010102">
<content-media type="InteractiveGraphicRollovers" id="cm6903122720">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010100/tl1305010102/cm6903122720.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010100/tl1305010102/cm6903122720text.xml"/></content-media>
<content-text><p><b>Examinar um design redundante</b></p> <p>Em um design hierárquico, a redundância é obtida nas camadas de distribuição e do núcleo através de hardware adicional e caminhos alternativos por esses equipamentos.</p> <p><b>Clique no botão Início – Acesso para camada de distribuição na figura.</b></p> <p>Neste exemplo, há uma rede hierárquica com camadas de acesso, distribuição e núcleo. Cada switch de camada de acesso é conectado a dois switches de camada de distribuição diferentes. Além disso, cada switch de camada de distribuição é conectado a ambos os switches da camada de núcleo. Devido à existência de diversos caminhos entre PC1 e PC4, há uma redundância que pode acomodar um único ponto de falha entre a camada de acesso e de distribuição, e entre a camada de distribuição e a do núcleo.</p> <p>O STP está habilitado em todos os switches. O STP é o tópico deste capítulo e será explicado detalhadamente. Por enquanto, observe que o STP colocou algumas portas de switch em estado de encaminhamento e outras em estado de bloqueio. Isto impede loops de camada 2 na rede. O STP somente utilizará um link redundante se houver falha no link primário.</p> <p>No exemplo, PC1 pode comunicar-se com PC4 pelo caminho identificado.</p> <p><b>Clique no botão Falha de caminho – Acesso para camada de distribuição na figura.</b></p> <p>O link entre o switch S1 e o switch D1 foi interrompido, impedindo que os dados de PC1 que eram destinados a PC4 alcançassem o switch D1 em seu caminho original. Entretanto, como o switch S1 possui um segundo caminho para PC4 através do switch D2, o caminho é atualizado e os dados podem chegar ao PC4.</p> <p><b>Clique no botão Falha de caminho  – Distribuição para camada de núcleo na figura.</b></p> <p>O link entre o switch D1 e o switch D2 foi interrompido, impedindo que os dados do PC1 que eram destinados a PC4 alcançassem o switch C2 em seu caminho original. Entretanto, como o switch D1 possui um segundo caminho para PC4 através do switch C1, o caminho é atualizado e os dados podem chegar ao PC4.</p> <p><b>Clique no botão Falha de switch – Camada de distribuição na figura.</b></p> <p>O switch D1 falhou, evitando que os dados de PC1, destinados a PC4, alcançassem o switch C2 em seu caminho original. Entretanto, desde que o switch S1 possua um segundo caminho para PC4 através do switch D2, o caminho é atualizado e os dados podem chegar ao PC4.</p> <p><b>Clique no botão Falha de switch – Camada de núcleo na figura.</b></p> <p>O switch C2 falhou, evitando que os dados de PC1 que eram destinados a PC4 alcançassem o switch D4 em seu caminho original. Entretanto, como o switch D1 possui um segundo caminho para PC4 através do switch C1, o caminho é atualizado e os dados podem chegar ao PC4.</p> <p>A redundância fornece muita flexibilidade nas escolhas de caminho em uma rede, permitindo que os dados sejam transmitidos independentemente da falha de um caminho ou dispositivo nas camadas de distribuição ou núcleo. A redundância tem algumas complicações que precisam ser abordadas antes de poder ser implementada de forma segura em uma rede hierárquica.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305010200">
<title><content-text>Problemas com a redundância</content-text></title>
<page type="OneColumn" id="tl1305010201">
<content-media type="AnimationPartialScreen" id="cm8959741771">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010200/tl1305010201/cm8959741771.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010200/tl1305010201/cm8959741771text.xml"/></content-media>
<content-text><p><b>Loops de camada 2 </b></p> <p>A redundância é uma parte importante do design hierárquico. Embora ela seja importante para a disponibilidade, existem algumas considerações que devem ser feitas antes de a redundância ser possível em uma rede.</p> <p>Quando existem diversos caminhos entre dois dispositivos na rede e o STP foi desabilitado nesses switches, pode ocorrer um loop de Camada 2. Se o STP estiver habilitado nestes switches, o que é o padrão, um loop de Camada 2 não ocorre.</p> <p>Quadros Ethernet não possuem um tempo de vida (<content-link target="{D7F5E517-2991-49F7-B10B-3A4D238DA810}" type="glossary">TTL</content-link>, Time To Live) como os pacotes IP que atravessam os roteadores. Como resultado, se eles não forem finalizados corretamente em uma rede comutada, eles continuarão saltando de switch para switch interminavelmente, ou até que um link seja interrompido e quebre o loop.</p> <p>Os quadros de broadcast são encaminhados por todas as portas de switch, exceto pela porta de origem. Isto garante que todos os dispositivos no domínio de broadcast possam receber o quadro. Se houver mais de um caminho para que o quadro seja encaminhado, o resultado poderá ser um loop ininterrupto.</p> <p><b>Clique no botão Reproduzir na figura para iniciar a animação.</b></p> <p>Na animação:</p> <p>1. PC1 envia um quadro de broadcast para o switch S2. </p> <p>2. Quando o S2 recebe o quadro de broadcast, ele atualiza sua tabela de endereços MAC para registrar que o PC1 está disponível na porta F0/11. </p> <p>3. Como se trata de um quadro de broadcast, o S2 encaminha o quadro para todas as portas de switch, inclusive o Tronco1 e o Tronco2. </p> <p>4. Quando o quadro de broadcast chega aos switches S3 e S1, eles atualizam suas tabelas de endereços MAC para indicar que PC1 está disponível na porta F0/1 em S1 e porta F0/2 em S3. </p> <p>5. Como se trata de um quadro de broadcast, S3 e S1 o encaminham para todas as portas de switch, exceto a porta na qual eles receberam o quadro. </p> <p>6. S3 envia, então, o quadro para S1 e vice-versa. Cada switch atualiza sua tabela de endereços MAC com a porta incorreta para PC1. </p> <p>7. Cada switch encaminha o quadro de broadcast novamente para todas as suas portas, exceto aquela pela qual ele chegou, resultando no encaminhamento do quadro para S2 em ambos os switches.</p> <p>8. Quando S2 recebe os quadros de broadcast de S3 e S1, a tabela de endereços MAC é atualizada mais uma vez, neste momento com a última entrada recebida dos outros dois switches. </p> <p>Este processo se repete inúmeras vezes até que o loop seja interrompido pela desconexão física das portas causadoras ou pelo desligamento de um dos switches no loop.</p> <p>Os loops resultam em uma carga de CPU alta em todos os switches envolvidos. Como os mesmos quadros estão sendo encaminhados constantemente de um lado para outro entre todos os switches, a CPU dos equipamentos acaba tendo que processar muitos dados. Isto reduz a velocidade de desempenho no switch quando para o tráfego necessário.</p> <p>Um host envolvido em um loop de rede não pode ser acessado por outros hosts na rede. Como a tabela de endereços MAC está constantemente mudando com as atualizações dos quadros de broadcast, o switch não sabe para qual porta encaminhar os quadros de unicast para alcançar o destino final. Os quadros de unicast também param de sofrer loop na rede. Como os quadros param cada vez mais de sofrer o loop na rede, ocorre uma broadcast storm.</p></content-text>
</page>
<page type="OneColumn" id="tl1305010202">
<content-media type="AnimationPartialScreen" id="cm3521427881">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010200/tl1305010202/cm3521427881.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010200/tl1305010202/cm3521427881text.xml"/></content-media>
<content-text><p><b>Broadcast storms</b></p> <p>Uma broadcast storm ocorre quando existem tantos quadros de broadcast presentes em um loop de Camada 2 que toda a largura de banda disponível é consumida. Conseqüentemente, não há nenhuma largura de banda disponível para tráfego legítimo e a rede fica indisponível para a comunicação de dados.</p> <p>Uma broadcast storm é inevitável em uma rede com loops. À medida que mais dispositivos enviam broadcasts na rede, cada vez mais tráfego é adicionado ao loop, criando eventualmente uma broadcast storm que causa a falha da rede.</p> <p>Existem outras conseqüências das broadcast storms. Como o tráfego de broadcast é encaminhado para todas as portas em um switch, todos os dispositivos conectados têm que processar esse tráfego que está sendo inundado interminavelmente pela rede com loops. Isto pode levar à falha de funcionamento do dispositivo devido aos requisitos de alto processamento para sustentar uma carga tão alta de tráfego na <content-link target="{9AB79491-096F-4FF5-9B18-3535B2A31227}" type="glossary">placa de rede</content-link>.</p> <p><b>Clique no botão Reproduzir na figura para iniciar a animação.</b></p> <p>Na animação:</p> <p>1. PC1 envia um quadro de broadcast para a rede com loops. </p> <p>2. O quadro de broadcast acaba sofrendo loops entre todos os switches interconectados na rede.</p> <p>3. PC4 também envia um quadro de broadcast para a rede com loops. </p> <p>4. O quadro de broadcast do PC4 também é capturado no loop e sofre loops entre todos os switches interconectados, da mesma forma que o quadro de broadcast do PC1. </p> <p>5. À medida que cada vez mais quadros de broadcast são enviados na rede por outros dispositivos, mais tráfego é capturado no loop, resultando eventualmente em uma broadcast storm. </p> <p>6. Quando a rede estiver completamente saturada com o tráfego de broadcast sofrendo loop entre os switches, novos tráfegos serão descartados pelo switch porque ele não será capaz de processá-los.</p> <p>Como os dispositivos conectados a uma rede enviam constantemente quadros de broadcast, tais como solicitações de ARP, uma broadcast storm pode se desenvolver em segundos. Como resultado, quando um loop é criado, a rede é desabilitada rapidamente.</p></content-text>
</page>
<page type="OneColumn" id="tl1305010203">
<content-media type="AnimationPartialScreen" id="cm2657468873">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010200/tl1305010203/cm2657468873.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010200/tl1305010203/cm2657468873text.xml"/></content-media>
<content-text><p><b>Quadros de unicast duplicados</b></p> <p>Os quadros de broadcast não são o único tipo de quadro afetado por loops. Quadros de unicast enviados em uma rede com loops podem resultar na chegada de quadros duplicados ao dispositivo de destino.</p> <p><b>Clique no botão Reproduzir na figura para iniciar a animação.</b></p> <p>Na animação:</p> <p>1. PC1 envia um quadro de unicast destinado ao PC4. </p> <p>2. O switch S2 não possui uma entrada para PC4 em sua tabela de MAC, assim ele envia o quadro de unicast para todas as portas de switch na tentativa de localizar o PC4. </p> <p>3. O quadro chega aos switches S1 e S3. </p> <p>4. S1 possui uma entrada de endereço MAC para PC4, assim ele encaminha o quadro para PC4. </p> <p>5. S3 também possui uma entrada em sua tabela de endereços MAC para PC4, desse modo ele encaminha o quadro de unicast pelo Tronco3 para S1. </p> <p>6. S1 recebe o quadro duplicado e, mais uma vez, o encaminha para PC4. </p> <p>7. PC4 recebe agora o mesmo quadro duas vezes.</p> <p>A maioria dos protocolos de camada superior não foi criada para reconhecer ou lidar com transmissões duplicadas. Em geral, os protocolos que utilizam um mecanismo de numeração de seqüência presumem que a transmissão falhou e que o <content-link target="{BD96A90F-5261-4D4D-836C-146032461C8D}" type="glossary">número de seqüência</content-link> foi reciclado para outra sessão de comunicação. Outros protocolos tentam entregar a transmissão duplicada ao protocolo de camada superior apropriado para que ela seja processada e possivelmente descartada.</p> <p>Felizmente, os switches são capazes de detectar loops em uma rede. O Protocolo Spanning Tree (STP) elimina estes problemas de loop. Você aprenderá sobre o STP na próxima seção.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305010300">
<title><content-text>Problemas de redundância do mundo real</content-text></title>
<page type="OneColumn" id="tl1305010301">
<content-media type="InteractiveGraphicRollovers" id="cm8338690347">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010300/tl1305010301/cm8338690347.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010300/tl1305010301/cm8338690347text.xml"/></content-media>
<content-text><p><b>Loops no wiring closet</b></p> <p>A redundância é um componente importante de uma topologia de rede hierárquica altamente disponível, mas podem surgir loops como resultado dos diversos caminhos configurados na rede. Você pode impedir os loops utilizando o Protocolo Spanning Tree (STP). Entretanto, se o STP não foi implementado na preparação para uma topologia redundante, podem ocorrer loops inesperadamente.</p> <p>O cabeamento de redes para pequenos e médios negócios pode tornar-se muito confuso. Cabos de rede entre os switches de camada de acesso, situados nos wiring closets, desaparecem nas paredes, nos pisos e nos tetos onde eles voltam para os switches de camada de distribuição na rede. Se os cabos de rede não receberem os rótulos adequados quando forem finalizados no <content-link target="{91B034DD-46D3-4FE4-B97B-8A1215971BF9}" type="glossary">patch panel</content-link> no wiring closet, será difícil determinar onde está o destino para a porta do patch panel na rede. São comuns os loops de rede resultantes de conexões duplicadas acidentais nos wiring closets.</p> <p><b>Clique no botão Loop de duas conexões com o mesmo switch na figura.</b></p> <p>O exemplo exibe um loop que ocorre se duas conexões do mesmo switch forem conectadas a outro switch. O loop está localizado nos switches que estão interconectados. Entretanto, o loop afeta o resto da rede devido ao alto encaminhamento de broadcast, que alcança todos os outros switches na rede. O impacto nos outros switches pode não ser suficiente para romper as comunicações legítimas, mas pode afetar consideravelmente o desempenho geral dos outros switches.</p> <p>Este tipo de loop é comum no wiring closet. Isto acontece quando um administrador acidentalmente conecta um cabo ao mesmo switch para o qual ele já está conectado. Isto normalmente ocorre quando os cabos de rede não recebem os rótulos ou os recebem de modo errado, ou quando o administrador não conferiu com calma onde os cabos estão conectados.</p> <p>Há uma exceção para este problema. Um EtherChannel é um agrupamento de portas Ethernet em um switch que age como uma única conexão de rede lógica. Como o switch trata as portas configuradas para o EtherChannel como um único link de rede, os loops não são possíveis. A configuração dos EtherChannels está além do escopo deste curso. Caso você queira saber mais sobre os EtherChannels, visite: <content-link target="http://www.cisco.com/en/US/tech/tk389/tk213/technologies_white_paper09186a0080092944.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk213/technologies_white_paper09186a0080092944.shtml</content-link> (em inglês)</p> <p><b>Clique no botão Loop de uma conexão com um segundo switch na mesma rede na figura.</b></p> <p>O exemplo mostra um loop que ocorre se um switch for conectado a dois switches diferentes que estão interconectados em uma rede. O impacto deste tipo de loop é muito maior, pois afeta mais switches diretamente. </p></content-text>
</page>
<page type="OneColumn" id="tl1305010302">
<content-media type="InteractiveGraphicRollovers" id="cm3558548482">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010300/tl1305010302/cm3558548482.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010300/tl1305010302/cm3558548482text.xml"/></content-media>
<content-text><p><b>Loops nos cubículos</b></p> <p>Devido às conexões insuficientes de dados de rede, alguns usuários finais possuem um hub ou switch pessoal localizado em seu ambiente de trabalho. Em vez de incorrer os custos de executar conexões de dados de rede adicionais no espaço de trabalho, um hub ou switch simples é conectado a uma conexão de rede existente, permitindo que todos os dispositivos conectados ao hub ou switch pessoal obtenham acesso à rede.</p> <p>Os wiring closets são normalmente protegidos para impedir o acesso não autorizado. Dessa forma, o administrador de rede geralmente é o único que possui total controle sobre como e quais dispositivos são conectados à rede. Diferentemente do wiring closet, o administrador não tem o controle de como os hubs e switches pessoais estão sendo utilizados ou conectados, então o usuário final pode interconectar os switches ou hubs acidentalmente.</p> <p><b>Clique no botão Loop de dois hubs interconectados na figura.</b></p> <p>No exemplo, os dois hubs de usuário estão interconectados, resultando em um loop de rede. O loop interrompe a comunicação entre todos os dispositivos conectados ao switch S1.</p></content-text>
</page>
<page type="OneColumn" id="tl1305010303">
<content-media type="ActivityPKA" id="cm8108696416">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010300/tl1305010303/cm8108696416/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305010000/tl1305010300/tl1305010303/cm8108696416/icontext.xml"/></content-media>
<content-text><p>Nesta atividade, você examinará como o STP funciona por padrão. Os switches foram adicionados à rede "prontos para uso". Os switches Cisco podem ser conectados a uma rede sem qualquer ação adicional pelo administrador de rede. Portanto, estes switches ainda não estão configurados.</p> <p>São fornecidas instruções detalhadas na atividade, bem como no link do PDF abaixo.</p> <p><content-link target="E3_PTAct_5_1_3.pdf" type="internalfile">Instruções da Atividade (PDF)</content-link></p> <p><b>Clique no ícone do Packet Tracer para obter mais detalhes.</b></p></content-text>
</page>
</topic>
</section>
<section type="" id="tl1305020000">
<title><content-text>Introdução ao STP</content-text></title>
<topic type="" id="tl1305020100">
<title><content-text>O algoritmo spanning tree</content-text></title>
<page type="OneColumn" id="tl1305020101">
<content-media type="AnimationPartialScreen" id="cm7357858340">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020100/tl1305020101/cm7357858340.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020100/tl1305020101/cm7357858340text.xml"/></content-media>
<content-text><p><b>Topologia de STP</b></p> <p>A redundância aumenta a disponibilidade da topologia de rede protegendo a rede de um único ponto de falha, como um cabo de rede ou um switch com defeito. Quando a redundância é introduzida em um design de Camada 2, podem ocorrer loops e quadros duplicados. Os loops e os quadros duplicados podem trazer graves conseqüências a uma rede. O Protocolo spanning tree (STP, Spanning Tree Protocol) foi desenvolvido para resolver estes problemas.</p> <p>O STP assegura que haja somente um caminho lógico entre todos os destinos na rede fazendo o <content-link target="{48DC2295-740D-4C48-80A2-A77009A412F9}" type="glossary">bloqueio</content-link> intencional dos caminhos redundantes que poderiam causar um loop. Uma porta é considerada bloqueada quando o tráfego da rede é impedido de entrar ou deixar aquela porta. Isto não inclui os quadros da unidade de dados de protocolo de bridge (<content-link target="{7325E922-35C1-4E53-BD8F-EE5B1AD2B92B}" type="glossary">BPDU</content-link>, bridge protocol data unit) que são utilizados pelo STP para impedir loops. Você obterá mais informações sobre os quadros de BPDU de STP posteriormente no capítulo. Bloquear os caminhos redundantes é essencial para impedir loops na rede. Os caminhos físicos ainda existem para fornecer a redundância, mas estes caminhos são desabilitados para impedir a ocorrência de loops. Se o caminho for necessário em algum momento para compensar a falha de um cabo de rede ou switch, o STP recalcula os caminhos e desbloqueia as portas necessárias para permitir que o caminho redundante fique ativo.</p> <p><b>Clique no botão Reproduzir na figura para iniciar a animação.</b></p> <p>No exemplo, todos os switches estão com o STP habilitado:</p> <p>1. PC1 envia um broadcast para a rede. </p> <p>2. O switch S3 é configurado com o STP e define a porta do Trunk2 para um estado de bloqueio. O estado de bloqueio impede que as portas sejam utilizadas para encaminhar o tráfego do switch, impedindo a ocorrência de um loop. O switch S2 encaminha um quadro de broadcast para todas as portas do switch, exceto a porta de origem do PC1, e a porta no Trunk2, que leva à porta bloqueada em S3. </p> <p>3. O switch S1 recebe o quadro de broadcast e o encaminha a todas as suas portas de switch, onde ele chega ao PC4 e S3. O S3 não encaminha o quadro de volta a S2 pelo Trunk2 por causa da porta bloqueada. O loop de Camada 2 é impedido.</p> <p><b>Clique no botão STP compensa a falha da rede na figura e clique em Reproduzir para iniciar a animação.</b></p> <p>Neste exemplo:</p> <p>1. PC1 envia um broadcast para a rede. </p> <p>2. O broadcast é então encaminhado pela rede, assim como na animação anterior. </p> <p>3. O link de trunk entre o switch S2 e o switch S1 falha, resultando na interrupção do caminho anterior. </p> <p>4. O switch S3 desbloqueia a porta bloqueada anteriormente para o Trunk2 e permite que o tráfego de broadcast atravesse o caminho alternativo para a rede, permitindo que a comunicação continue. Se este link ficar novamente ativo, o STP será reconvergido e a porta em S3 será bloqueada novamente.</p> <p>O STP impede que os loops ocorram configurando um caminho sem loops pela rede, utilizando portas de estado de bloqueio estrategicamente posicionadas. Os switches que executam o STP são capazes de compensar as falhas desbloqueando dinamicamente as portas bloqueadas anteriormente e permitindo que o tráfego atravesse os caminhos alternativos. O próximo tópico descreve como o STP realiza este processo automaticamente.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020102">
<content-media type="StaticGraphic" id="cm2890436022">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020100/tl1305020102/cm2890436022.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020100/tl1305020102/cm2890436022text.xml"/></content-media>
<content-text><p><b>Algoritmo STP</b></p> <p>O STP utiliza o Algoritmo spanning tree (<content-link target="{2E20BEC9-C39A-4E09-BEAD-E5B244449406}" type="glossary">STA</content-link>, Spanning Tree Algorithm) para determinar quais portas de switch em uma rede precisam ser configuradas para bloqueio a fim de impedir a ocorrência de loops. O STA designa um único switch como a <content-link target="{9A230324-DAFA-4F0F-8FF8-4AD66C9055EC}" type="glossary">bridge raiz</content-link> e o utiliza como ponto de referência para todos os cálculos de caminho. Na figura, a bridge raiz, switch S1, é escolhida através de um processo de escolha. Todos os switches que participam de STP trocam quadros de BPDU para determinar qual switch possui a ID de bridge (BID) mais baixa na rede. O switch com o BID mais baixo se torna automaticamente a bridge raiz para os cálculos de STA. O processo de escolha de bridge raiz será discutido em detalhes posteriormente neste capítulo.</p> <p>O BPDU é o quadro de mensagem trocado pelos switches para STP. Cada BPDU contém um BID que identifica o switch que enviou o BPDU. O BID contém um valor de prioridade, o endereço MAC do switch de envio, e uma ID de sistema estendido opcional. Determina-se o valor de BID mais baixo através da combinação destes três campos. Você obterá mais informações sobre a bridge raiz, BPDU e BID em tópicos posteriores.</p> <p>Depois que a bridge raiz tiver sido determinada, o STA calcula o caminho mais curto para a bridge raiz. Cada switch utiliza o STA para determinar quais portas bloquear. Enquanto o STA determina os melhores caminhos para a bridge raiz para todos os destinos no domínio de broadcast, todo o tráfego é impedido de ser encaminhado pela rede. O STA considera ambos os custos do caminho e porta ao determinar qual caminho permanecerá desbloqueado. Um <content-link target="{645B6073-78F7-4A3D-A408-7013391FAFF8}" type="glossary">custo do caminho</content-link> é calculado utilizando os valores de custo de porta associados com as velocidades de cada porta de switch ao longo de um determinado caminho. A soma dos valores de custo de porta determina o custo de caminho geral para a bridge raiz. Se houver mais de um caminho a ser escolhido, o STA escolherá o caminho com o custo de caminho mais baixo. Você obterá mais informações sobre os custos de caminho e porta em tópicos posteriores.</p> <p>Quando o STA determinar quais caminhos permanecerão disponíveis, ele configurará as portas do switch em  diferentes funções . As funções de porta descrevem sua relação na rede até a bridge raiz e se elas podem encaminhar o tráfego. </p> <p><b>Portas raiz</b> - As portas de switch mais próximas da bridge raiz. No exemplo, a porta raiz no switch S2 é F0/1 configurada para o link de trunk entre o switch S2 e o switch S1. A porta raiz no switch S3 é F0/1, configurada para o link de trunk entre o switch S3 e o switch S1.</p> <p><b>Portas designadas</b> - Todas as portas não-raiz que ainda podem encaminhar o tráfego na rede. No exemplo, as portas F0/1 e F0/2 no switch S1 são portas designadas. O switch S2 também está com sua porta F0/2 configurada como uma porta designada.</p> <p><b>Portas não-designadas</b> - Todas as portas configuradas a um estado de bloqueio para impedir loops. No exemplo, o STA configurou a porta F0/2 no switch S3 na função não-designada. A porta F0/2 no switch S3 está no estado de bloqueio.</p> <p>Você obterá mais informações sobre as funções de porta em um tópico posterior.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020103">
<content-media type="StaticGraphic" id="cm2709716635">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020100/tl1305020103/cm2709716635.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020100/tl1305020103/cm2709716635text.xml"/></content-media>
<content-text><p><b>A bridge raiz</b></p> <p>Toda instância de spanning tree (rede local comutada ou domínio de broadcast) possui um switch designado como bridge raiz. A bridge raiz serve como um ponto de referência para que todos os cálculos de spanning tree determinem quais caminhos redundantes bloquear.</p> <p>Um processo de escolha determina qual switch se torna a bridge raiz. </p> <p><b>Clique no botão Campos de BID na figura.</b></p> <p>A figura mostra os campos de BID. Os detalhes de cada campo de BID são discutidos posteriormente, mas convém saber agora que o BID é determinado a partir de um valor de prioridade, de uma ID de sistema estendido e do endereço MAC do switch.</p> <p>Todos os switches no domínio de broadcast participam do processo de escolha. Depois de um switch ser inicializado, ele envia os quadros de BPDU contendo o BID do switch e a ID de raiz a cada 2 segundos. Por padrão, a ID de raiz corresponde ao BID local para todos os switches na rede. A ID de raiz identifica a bridge raiz na rede. Inicialmente, cada switch identifica-se como a bridge raiz depois de ser inicializado.</p> <p>Conforme os switches encaminham seus quadros de BPDU, os switches adjacentes no domínio de broadcast lêem as informações da ID de raiz do quadro de BPDU. Se a ID de raiz do BPDU recebido for mais baixa do que a ID de raiz do switch de recebimento, este atualizará sua ID de raiz identificando o switch adjacente como a bridge  raiz. Nota: Pode não ser um switch adjacente, mas qualquer outro switch no domínio de broadcast. O switch encaminha então os novos quadros de BPDU com a ID de raiz mais baixa aos outros switches adjacentes. O switch com o BID mais baixo acaba eventualmente sendo identificado como a bridge raiz para a instância de spanning tree. </p></content-text>
</page>
<page type="OneColumn" id="tl1305020104">
<content-media type="InteractiveGraphicRollovers" id="cm9062133227">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020100/tl1305020104/cm9062133227.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020100/tl1305020104/cm9062133227text.xml"/></content-media>
<content-text><p><b>Melhores caminhos para a bridge raiz</b></p> <p>Quando a bridge raiz for designada para a instância de spanning tree, o STA iniciará o processo de determinar os melhores caminhos para a bridge raiz de todos os destinos no domínio de broadcast. As informações de caminho são determinadas somando os custos de portas individuais ao longo do caminho, desde o destino até a bridge raiz.</p> <p>Os custos de porta padrão são definidos pela velocidade na qual a porta opera. Na tabela, você pode ver que as portas Ethernet de 10 Gb/s possuem um custo de 2, as portas Ethernet de 1 Gb/s possuem um custo de 4, as portas Fast Ethernet de 100 Mb/s têm um custo de 19 e as portas Ethernet de10 Mb/s têm um custo de 100. </p> <p><b>Nota:</b> O IEEE define os valores de custo de porta utilizados pelo STP. Conforme tecnologias de Ethernet mais recentes e rápidas entram no mercado, os valores de custo de caminho podem ser alterados para acomodar as diferentes velocidades disponíveis. Os números não lineares acomodam algumas melhorias ao padrão da Ethernet, mas esteja ciente de que os números podem ser alterados pelo IEEE caso seja necessário. Na tabela, os valores já foram alterados para acomodar o mais novo padrão de Ethernet de 10 Gb/s.</p> <p>Embora as portas de switch possuam um custo de porta padrão associado a elas, este custo é configurável. A capacidade de configurar os custos de portas individuais proporciona ao administrador a flexibilidade para controlar os caminhos de spanning tree até a bridge raiz.</p> <p><b>Clique no botão Configurando os custos de porta na figura.</b></p> <p>Para configurar o custo de porta de uma interface, digite o comando <span class="cmd"><b>spanning-tree cost </b><i>value</i></span> no modo de configuração de interface. O <i>range </i><span class="cmd">value</span> (valor do intervalo) pode estar entre 1 e 200.000.000.</p> <p>No exemplo, a porta de switch F0/1 foi configurada com o custo de porta de 25 utilizando o comando de configuração de interface <span class="cmd"><b>spanning-tree cost 25</b></span> na interface F0/1.</p> <p>Para reverter o custo de porta de volta para o valor padrão, digite o comando de configuração de interface <span class="cmd"><b>no spanning-tree cost</b></span>.</p> <p><b>Clique no botão Custos de caminho na figura.</b></p> <p>O custo de caminho é a soma de todos os custos de porta ao longo do caminho até a bridge raiz. Os caminhos com o custo  mais baixo tornam-se os preferidos e todos os outros caminhos redundantes são bloqueados. No exemplo, o caminho de custo do switch S2 ao S1 da bridge raiz pelo caminho 1 é 19 (baseado no custo de porta individual especificado pelo IEEE), enquanto o custo de caminho pelo caminho 2 é 38. Como o caminho 1 possui um custo de caminho geral mais baixo para a bridge raiz, ele é o preferido. O STP configura então o caminho redundante para que ele seja bloqueado, impedindo a ocorrência de um loop.</p> <p><b>Clique no botão Verificar custos de porta e caminho na figura.</b></p> <p>Para verificar o custo de porta e caminho para a bridge raiz, digite o comando de modo EXEC privilegiado <span class="cmd"><b>show spanning-tree</b></span>. O campo Custo na saída de dados é o custo de caminho total para a bridge raiz. Este valor muda dependendo de quantas portas de switch precisem ser atravessadas para que se chegue à bridge raiz. Na saída de dados, cada interface também é identificada com um custo de porta individual de 19. </p> <p>Outro comando para explorar é o de modo EXEC privilegiado <span class="cmd"><b>show spanning-tree detail</b></span>.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305020200">
<title><content-text>BPDU de STP</content-text></title>
<page type="OneColumn" id="tl1305020201">
<content-media type="InteractiveGraphicRollovers" id="cm1061344390">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020200/tl1305020201/cm1061344390.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020200/tl1305020201/cm1061344390text.xml"/></content-media>
<content-text><p><b>Os campos BPDU</b></p> <p>No tópico anterior, você aprendeu que o STP determina uma bridge raiz para a instância de spanning tree trocando BPDUs. Neste tópico, você aprenderá os detalhes do quadro de BPDU e como ele facilita o processo de spanning tree.</p> <p>O quadro de BPDU contém 12 campos distintos que são utilizados para comunicar informações de caminho e prioridade que o STP utiliza para determinar a bridge raiz e os caminhos para a bridge raiz.</p> <p><b>Passe o mouse sobre os Campos BPDU na figura para saber o que eles contêm.</b></p> <p><ul><li> Os primeiros quatro campos identificam o protocolo, a versão, o tipo de mensagem e os flags de status.</li><li>Os quatro campos seguintes são utilizados para identificar a bridge raiz e o custo do caminho para a bridge raiz.</li><li> Os últimos quatro campos são todos campos de temporizador, que determinam com que freqüência as mensagens de BPDU são enviadas e por quanto tempo as informações recebidas pelo processo de BPDU (próximo tópico) são retidas. A função dos campos de temporizador será abordada posteriormente em mais detalhes neste curso.</li></ul></p> <p><b>Clique no botão Exemplo de BPDU na figura.</b></p> <p>O exemplo na figura foi capturado utilizando o Wireshark. No exemplo, o quadro de BPDU contém mais campos do que o descrito anteriormente. A mensagem de BPDU é encapsulada em um quadro Ethernet quando ela é transmitida através da rede. O cabeçalho 802.3 indica os endereços de origem e destino do quadro de BPDU. Este quadro possui um endereço MAC de destino de 01:80:C2:00:00:00, que é um endereço de multicast para o grupo de spanning tree. Quando um quadro é mencionado com este endereço MAC, cada switch que está configurado para spanning tree aceita e lê as informações do quadro. Utilizando este endereço de grupo multicast, todos os outros dispositivos na rede que recebem este quadro o desconsideram.</p> <p>No exemplo, a ID de raiz e o BID são os mesmos no quadro de BPDU capturado. Isto indica que o quadro foi capturado de um switch de bridge raiz. </p> <p>Os temporizadores estão todos definidos com seus valores padrão.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020202">
<content-media type="AnimationPartialScreen" id="cm7714824057">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020200/tl1305020202/cm7714824057.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020200/tl1305020202/cm7714824057text.xml"/></content-media>
<content-text><p><b>O processo BPDU</b></p> <p>Cada switch no domínio de broadcast presume inicialmente que é a bridge raiz para a instância de spanning tree, desse modo os quadros de BPDU enviados contêm o BID do switch local como a ID de raiz. Por padrão, os quadros de BPDU são enviados a cada 2 segundos depois de um switch ser inicializado; ou seja, o valor padrão do temporizador hello especificado no quadro de BPDU é de 2 segundos. Cada switch mantém as informações locais sobre seu próprio BID, ID de raiz e o custo de caminho para a raiz.</p> <p>Quando os switches adjacentes recebem um quadro de BPDU, eles comparam a ID de raiz do quadro de BPDU com a ID de raiz local. Se a ID de raiz no BPDU for mais baixa do que a ID de raiz local, o switch atualiza a ID de raiz local e a ID em suas mensagens de BPDU. Estas mensagens servem para indicar a nova bridge raiz na rede. Além disso, o custo de caminho é atualizado para indicar a distância da bridge raiz. Por exemplo, se o BPDU foi recebido em uma porta de switch Fast Ethernet, o custo de caminho seria definido como 19. Se a ID de raiz local for inferior à ID de raiz recebida no quadro de BPDU, o quadro de BPDU será descartado.</p> <p>Depois que uma ID de raiz for atualizada para identificar uma nova bridge raiz, todos os quadros de BPDU subseqüentes enviados daquele switch conterão a nova ID de raiz e o custo de caminho atualizado. Desse modo, todos os outros switches adjacentes podem ver a ID de raiz mais baixa sempre identificada. Como os quadros de BPDU passam entre outros switches adjacentes, o custo de caminho é atualizado continuamente para indicar o custo de caminho total até a bridge raiz. Cada switch no spanning tree utiliza seus custos de caminho para identificar o melhor caminho possível para a bridge raiz.</p> <p><b>Clique em cada etapa na figura para aprender sobre o processo de BPDU.</b></p> <p>Segue um resumo do processo de BPDU:</p> <p>Nota: A prioridade é o fator decisivo inicial ao escolher uma bridge raiz. Se a prioridade de todos os switches fosse a mesma, o endereço MAC seria o fator decisivo.</p> <p><b>Etapa 1. </b>Inicialmente, cada switch se identifica como a bridge raiz. O switch S2 encaminha os quadros de BPDU para todas as portas de switch. </p> <p><b>Etapa 2. </b>Quando o switch S3 recebe um BPDU do switch S2, ele compara sua ID de raiz com o quadro de BPDU que recebeu. As prioridades são iguais, desse modo o switch é forçado a examinar a parte de endereço MAC para determinar qual endereço MAC possui um valor inferior. Como o S2 possui um valor de endereço MAC inferior, S3 atualiza sua ID de raiz com a ID de raiz de S2. Neste ponto, S3 considera S2 como a bridge raiz. </p> <p><b>Etapa 3.</b> Quando S1 compara sua ID de raiz com a ID no quadro de BPDU recebido, ele identifica a ID de raiz local como o valor inferior e descarta o BPDU de S2.</p> <p><b>Etapa 4. </b>Quando S3 envia seus quadros de BPDU, a ID de raiz contida no quadro de BPDU é a de S2. </p> <p><b>Etapa 5.</b> Quando S2 recebe o quadro de BPDU, ele o descarta depois de verificar que a ID de raiz no BPDU correspondeu à sua ID de raiz local.</p> <p><b>Etapa 6.</b> Como S1 tem um valor de prioridade inferior em sua ID de raiz, ele descarta o quadro de BPDU recebido de S3.</p> <p><b>Etapa 7.</b> S1 envia seus quadros de BPDU.</p> <p><b>Etapa 8.</b> S3 identifica a ID de raiz no quadro de BPDU como tendo um valor inferior e, portanto, atualiza seus valores de ID de raiz para indicar que S1 é agora a bridge raiz.</p> <p><b>Etapa 9.</b> S2 identifica a ID de raiz no quadro de BPDU como tendo um valor inferior e, portanto, atualiza seus valores de ID de raiz para indicar que S1 é agora a bridge raiz.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305020300">
<title><content-text>ID de bridge</content-text></title>
<page type="OneColumn" id="tl1305020301">
<content-media type="InteractiveGraphicRollovers" id="cm7118167866">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020300/tl1305020301/cm7118167866.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020300/tl1305020301/cm7118167866text.xml"/></content-media>
<content-text><p><b>Campos BID</b></p> <p>A ID de bridge (BID) é utilizada para determinar a bridge raiz em uma rede. Este tópico descreve o que compõe um BID e como configurá-lo em um switch para influenciar o processo de escolha a fim de assegurar que switches específicos sejam atribuídos à função de bridge raiz na rede.</p> <p>O campo BID de um quadro de BPDU contém três campos separados: prioridade de bridge, a ID de sistema estendido e o endereço MAC. Cada campo é utilizado durante a escolha de bridge raiz.</p> <p><b>Prioridade de bridge</b></p> <p>A prioridade de bridge é um valor personalizável que você pode utilizar para influenciar qual switch se torna a bridge raiz. O switch com a prioridade mais baixa, que significa o BID mais baixo, se torna a bridge raiz (quanto menor for o valor de prioridade, maior a prioridade). Por exemplo, para assegurar que um switch específico seja sempre a bridge raiz, você define a prioridade como um valor inferior do que o resto dos switches na rede. O valor padrão para a prioridade de todos os switches da Cisco é 32768. O intervalo de prioridade está entre 1 e 65536; portanto, 1 é a prioridade mais alta.</p> <p><b>ID de sistema estendido</b></p> <p>Conforme mostrado no exemplo, a ID de sistema estendido pode ser omitida em quadros de BPDU em certas configurações. A implementação inicial de STP foi criada para redes que não utilizam VLANs. Havia um único spanning tree comum em todos os switches. Quando as VLANs começaram a ficar comuns para a segmentação de infra-estrutura de rede, o STP foi aprimorado para incluir suporte para VLANs. Como resultado, o campo de ID do sistema estendido contém a ID da VLAN com a qual o BPDU está associado. </p> <p>Quando a ID de sistema estendido é utilizada, ela altera o número de bits disponíveis para o valor de prioridade de bridge, assim o aumento para o valor de prioridade de bridge varia de 1 até 4096. Portanto, os valores de prioridade de bridge somente podem ser múltiplos de 4096.</p> <p>O valor de ID de sistema estendido é adicionado ao valor de prioridade de bridge no BID para identificar a prioridade e a VLAN do quadro de BPDU.</p> <p>Você aprenderá sobre o protocolo spanning tree de VLAN(per VLAN spanning tree, PVST) em uma seção posterior deste capítulo.</p> <p><b>Endereço MAC</b></p> <p>Quando dois switches são configurados com a mesma prioridade e possuem a mesma ID de sistema estendido, o switch com o endereço MAC com o valor hexadecimal mais baixo tem o BID mais baixo. Inicialmente, todos os switches são configurados com o mesmo valor de prioridade padrão. O endereço MAC é, então, o fator decisivo com relação ao qual o switch vai se tornar a bridge raiz. Isto resulta em uma escolha imprevisível pela bridge raiz. Recomenda-se configurar o switch de bridge raiz desejado com uma prioridade inferior para assegurar que ele seja a bridge raiz escolhida. Isto também garante que a adição de novos switches à rede não dispare uma nova escolha de spanning tree, o que poderia interromper a comunicação da rede enquanto uma nova bridge raiz estiver sendo selecionada.</p> <p><b>Clique no botão Decisão baseada em prioridade na figura.</b></p> <p>No exemplo, S1 possui uma prioridade mais baixa que a dos outros switches; portanto, é a bridge raiz preferida para aquela instância de spanning tree.</p> <p><b>Clique no botão Decisão baseada no Endereço MAC na figura.</b></p>  <p>Quando todos os switches estão configurados com a mesma prioridade, como é o caso com todos os switches mantidos na configuração padrão, com uma prioridade de 32768, o endereço MAC se torna o fator decisivo pelo qual um switch se torna a bridge raiz.</p> <p><b>Nota:</b> No exemplo, a prioridade de todos os switches é 32769. O valor é baseado na prioridade padrão de 32768 e na atribuição de VLAN 1 associada a cada switch (1+32768).</p> <p>O endereço MAC com o valor hexadecimal mais baixo é considerado a bridge raiz preferida. No exemplo, S2 tem o valor mais baixo para seu endereço MAC e é designado, portanto, como a bridge raiz para aquela instância de spanning tree.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020302">
<content-media type="InteractiveGraphicRollovers" id="cm9895864332">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020300/tl1305020302/cm9895864332.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020300/tl1305020302/cm9895864332text.xml"/></content-media>
<content-text><p><b>Configurar e verificar o BID</b></p> <p>Quando um switch específico deve tornar-se a bridge raiz, o valor de prioridade da bridge precisará ser ajustado para assegurar que ele seja mais baixo do que os valores de prioridade de bridge de todos os outros switches na rede. Existem dois métodos de configuração diferentes que você pode utilizar para configurar o valor de prioridade de bridge em um switch Cisco Catalyst.</p> <p><b>Método 1</b> - Para assegurar que o switch tenha o valor de prioridade mais baixo, utilize o comando <span class="cmd"><b>spanning-tree vlan </b><i>vlan-id</i><b> root primary</b></span> no modo de configuração global. A prioridade para o switch é estabelecida como o valor pré-definido de 24576 ou para o valor de diminuição de 4096 seguinte, abaixo da prioridade de bridge mais baixa detectada na rede.</p> <p>Se uma bridge raiz alternativa for desejada, utilize o comando do modo de configuração global <span class="cmd"><b>spanning-tree vlan </b><i>vlan-id</i><b> root secondary</b></span>. Este comando define a prioridade para o switch ao valor pré-definido de 28672. Isto assegura que este switch se tornará a bridge raiz no caso de a bridge raiz inicial falhar e caso ocorra uma nova escolha de bridge raiz e supondo que o resto dos switches na rede tenha o valor de prioridade padrão de 32768 definido.</p> <p>No exemplo, o switch S1 foi atribuído como a bridge raiz primária utilizando o comando do modo de configuração global <span class="cmd"><b>spanning-tree vlan 1 root primary</b></span>; e o switch S2 foi configurado como a bridge raiz secundária utilizando o comando do modo de configuração global <span class="cmd"><b>spanning-tree vlan 1 root secondary</b></span>.</p> <p><b>Método 2</b> - Outro método para configurar o valor de prioridade de bridge é utilizar o comando do modo de configuração global <span class="cmd"><b>spanning-tree vlan </b><i>vlan-id</i><b> priority </b><i>value</i></span>. Este comando proporciona um maior controle granular sobre o valor de prioridade de bridge. O valor de prioridade é configurado em acréscimos de 4096 entre 0 e 65536. </p> <p>No exemplo, o switch S3 recebeu um valor de prioridade de bridge de 24576 utilizando o comando do modo de configuração global <span class="cmd"><b>spanning-tree vlan 1 priority 24576</b></span>.</p> <p><b>Clique no botão Verificação na figura.</b></p> <p>Para verificar a prioridade de bridge de um switch, utilize o comando do modo EXEC privilegiado show spanning-tree. No exemplo, a prioridade do switch foi definida em 24576. Observe também que o switch está designado como a bridge raiz para a instância de spanning tree.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305020400">
<title><content-text>Funções de porta</content-text></title>
<page type="OneColumn" id="tl1305020401">
<content-media type="StaticGraphic" id="cm4461076129">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020400/tl1305020401/cm4461076129.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020400/tl1305020401/cm4461076129text.xml"/></content-media>
<content-text><p><b>Funções de porta </b></p> <p>A bridge raiz é escolhida para a instância de spanning tree. O local da bridge raiz na topologia de rede determina como as funções de porta são calculadas. Este tópico descreve como as portas de switch são configuradas para as funções específicas a fim de impedirem a possibilidade de loops na rede.</p> <p>Existem quatro funções de porta diferentes nas quais as portas de switch são automaticamente configuradas durante o processo de spanning tree.</p> <p><b>Porta raiz</b></p> <p>A porta raiz existe em bridges não-raiz. Trata-se da porta de switch com o melhor caminho para a bridge raiz. Asportas raiz encaminham o tráfego para a bridge raiz. O endereço MAC de origem dos quadros recebido na porta raiz é capaz de preencher a tabela de MAC. Somente uma porta raiz é permitida por bridge.</p> <p>No exemplo, o switch S1 é a bridge raiz e os switches S2 e S3 possuemportas raiz definidas nos links de tronco, conectando-se de volta a S1.</p> <p><b>Porta designada</b></p> <p>A porta designada existe em bridges de raiz e não-raiz. Para bridges de raiz, todas as portas de switch são portas designadas. Para bridges não-raiz, uma porta designada é a porta de switch que recebe e encaminha os quadros para a bridge raiz conforme o necessário. Permite-se somente uma porta designada por segmento. Se vários switches existirem no mesmo segmento, um processo de escolha determinará o switch designado e a porta de switch correspondente começará a encaminhar quadros para o segmento. As portas designadas são capazes de preencher a tabela de MAC.</p> <p>No exemplo, o switch S1 possui ambos os conjuntos de portas para seus dois links de tronco configurados como portas designadas. O switch S2 possui uma porta designada configurada no link de tronco que vai para o switch S3.</p> <p><b>Porta não designada</b></p> <p>A porta não-designada é uma porta de switch que está bloqueada, assim ela não encaminha estruturas de dados e não preenche a tabela de endereços MAC com endereços de origem. Uma porta não-designada não é uma porta raiz ou uma porta designada. Para algumas variantes de STP, a porta não-designada é chamada de porta alternativa.</p> <p>No exemplo, o switch S3 possui as únicas portas não-designadas na topologia. As portas não-designadas impedem a ocorrência de loops.</p> <p><b>Porta desabilitada</b></p> <p>A porta desabilitada é uma porta de switch que está administrativamente desligada. Uma porta desabilitada não funciona no processo de spanning tree. Não existem portas desabilitadas no exemplo.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020402">
<content-media type="StaticGraphic" id="cm5493627119">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020400/tl1305020402/cm5493627119.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020400/tl1305020402/cm5493627119text.xml"/></content-media>
<content-text><p><b>Funções de porta</b></p> <p>O STA determina qual função de porta é atribuída a cada porta de switch. </p> <p>Ao determinar a porta raiz em um switch, o switch compara os custos de caminho em todas as portas de switch que participam do spanning tree. A porta de switch com o custo de caminho geral mais baixo para a raiz é atribuída automaticamente à função de raiz, pois ela está mais perto da bridge raiz. Em uma topologia de rede, todos os switches que estão utilizando o spanning tree, com exceção da bridge raiz, possuem uma única porta raiz definida.</p> <p>Quando existem duas portas de switch que possuem o mesmo custo de caminho para a bridge raiz e ambas são o caminho com custo mais baixo no switch, o switch precisa determinar qual porta de switch é a porta raiz. O switch utiliza o valor de prioridade de porta personalizável, ou a ID de porta mais baixa, se os valores de prioridade de porta forem os mesmos. </p> <p>A ID de porta é a ID de interface da porta de switch. Por exemplo, a figura mostra quatro switches. As portas F0/1 e F0/2 no switch S2 possuem o mesmo valor de custo de caminho de volta para a bridge raiz. Entretanto, a porta F0/1 no switch S2 é a porta preferida porque possui um valor de ID de porta mais baixo. </p> <p>A ID de porta é adicionada à prioridade de porta. Por exemplo, a porta de switch F0/1 possui um valor de prioridade de porta padrão de 128.1, onde 128 é o valor de prioridade de porta configurável e .1 é a ID da porta. A porta de switch F0/2 possui um valor de prioridade de porta de 128.2, por padrão.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020403">
<content-media type="StaticGraphic" id="cm6199882431">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020400/tl1305020403/cm6199882431.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020400/tl1305020403/cm6199882431text.xml"/></content-media>
<content-text><p><b>Configurar prioridade de porta</b></p> <p>Você pode configurar o valor de prioridade de porta utilizando o comando do modo de configuração de interface <span class="cmd"><b>spanning-tree port-priority </b><i>value</i></span>. Os valores de prioridade de porta variam de 0 a 240, em acréscimos de 16. O valor de prioridade de porta padrão é 128. Da mesma forma que acontece com a prioridade de bridge, os valores de prioridade de porta mais baixos conferem à porta uma maior prioridade. </p> <p>No exemplo, a prioridade de porta para a porta F0/1 foi definida em 112, que está abaixo da prioridade de porta padrão de 128. Isto garante que esta porta seja a porta preferida ao competir com outra porta para uma função de porta específica.</p> <p>Quando o switch decidir utilizar uma porta em vez de outra porta raiz, a outra é configurada como uma porta não-designada para impedir a ocorrência de um loop.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020404">
<content-media type="InteractiveGraphicRollovers" id="cm5833104874">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020400/tl1305020404/cm5833104874.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020400/tl1305020404/cm5833104874text.xml"/></content-media>
<content-text><p><b>Decisões de função de porta</b></p> <p>No exemplo, o switch S1 é a bridge raiz. Os switches S2 e S3 possuemportas raiz configuradas para as portas que se conectam de volta a S1.</p> <p>Depois que um switch determina qual de suas portas é configurada na função de porta raiz, ele precisa decidir quais portas possuem as funções de designadas e não-designadas.</p> <p>A bridge raiz configura automaticamente todas as suas portas de switch na função designada. Outros switches na topologia configuram suas portas não-raiz como portas designadas ou não-designadas.</p> <p>As portas designadas são configuradas para todos os segmentos de rede local. Quando são conectados dois switches ao mesmo segmento de rede local e asportas raiz já foram definidas, os dois switches devem decidir qual porta fica configurada como a porta designada e qual é deixada como a porta não-designada.</p> <p>Os switches no segmento de rede local em questão trocam quadros de BPDU, que contém o BID do switch. Geralmente, o switch com o BID mais baixo tem sua porta configurada como uma porta designada, enquanto o switch com o BID mais alto tem sua porta configurada como uma porta não-designada. Porém, lembre-se de que a primeira prioridade é o custo de caminho mais baixo para a bridge raiz e que, somente se os custos de porta forem iguais, o BID do remetente será utilizado.</p> <p>Como resultado, cada switch determina quais funções de porta serão atribuídas a cada uma de suas portas a fim de criar um spanning tree sem loops.</p> <p><b>Clique em cada etapa na figura </b>para saber como as funções de porta são determinadas.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020405">
<content-media type="StaticGraphic" id="cm5806744553">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020400/tl1305020405/cm5806744553.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020400/tl1305020405/cm5806744553text.xml"/></content-media>
<content-text><p><b>Verificando as funções de porta e prioridade de porta</b></p> <p>Agora que o spanning tree determinou a topologia de rede lógica sem loop, talvez você deseje confirmar quais funções de porta e prioridades de porta estão configuradas para as diversas portas de switch na rede.</p> <p>Para verificar as funções de porta e as prioridades de porta para as portas de switch, utilize o comando de modo EXEC privilegiado <span class="cmd"><b>show spanning-tree</b></span>.</p> <p>No exemplo, a saída de dados do comando <span class="cmd"><b>show spanning-tree</b></span> exibe todas as portas do switch e suas funções definidas. As portas do switch F0/1 e F0/2 estão configuradas como portas designadas. A saída de dados também exibe a prioridade de porta de cada porta de switch. A porta de switch F0/1 possui uma prioridade de porta de 128.1.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305020500">
<title><content-text>Estados de porta de STP e temporizadores de BPDU</content-text></title>
<page type="OneColumn" id="tl1305020501">
<content-media type="StaticGraphic" id="cm9723878434">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020500/tl1305020501/cm9723878434.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020500/tl1305020501/cm9723878434text.xml"/></content-media>
<content-text><p><b>Estados de porta </b></p> <p>O STP determina o caminho lógico sem loop ao longo do domínio de broadcast. O spanning tree é determinado através das informações obtidas pela troca de quadros de BPDU entre os switches interconectados. Para facilitar a obtenção do spanning tree lógico, cada porta de switch muda através de cinco estados de porta possíveis e três temporizadores de BPDU.</p> <p>O spanning tree é determinado imediatamente depois que um switch acaba de ser inicializado. Se uma porta de switch fosse fazer a transição diretamente do estado de bloqueio para o estado de encaminhamento, a porta poderia criar temporariamente um loop de dados se o switch não soubesse de todas as informações da topologia neste momento. Por esta razão, o STP introduz cinco estados de porta. A tabela resume o que faz cada estado de porta. Veja a seguir algumas informações adicionais sobre como os estados de porta asseguram que nenhum loop seja criado durante a criação do spanning tree lógico.</p> <p><ul><li><b>Bloqueio</b> - A porta é uma porta não-designada e não participa do encaminhamento de quadros. Ela recebe quadros de BPDU para determinar o local e a ID de raiz do switch de bridge raiz e quais funções de porta cada porta de switch deve assumir na topologia de STP ativa final.</li><li><b>Escuta</b> - O STP determinou que a porta pode participar do encaminhamento de quadros de acordo com os quadros de BPDU que o switch recebeu até o momento. Neste momento, a porta de switch não só recebe quadros de BPDU, como também transmite seus próprios quadros de BPDU e informa os switches adjacentes de que a porta de switch está se preparando para participar da topologia ativa.</li><li><b>Aprendizagem</b> - A porta se prepara para participar do encaminhamento de quadros e começa a preencher a tabela de endereços MAC. </li><li><b>Encaminhamento</b> - A porta é considerada parte da topologia ativa e encaminha quadros, bem como envia e recebe quadros de BPDU. </li><li><b>Desabilitado</b> - A porta de Camada 2 não participa de spanning tree e não encaminha quadros. O estado desabilitado é definido quando a porta de switch é desabilitada administrativamente.</li></ul></p></content-text>
</page>
<page type="OneColumn" id="tl1305020502">
<content-media type="InteractiveGraphicRollovers" id="cm3451815512">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020500/tl1305020502/cm3451815512.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020500/tl1305020502/cm3451815512text.xml"/></content-media>
<content-text><p><b>Temporizadores de BPDU</b></p> <p>A quantidade de tempo que uma porta permanece nos diversos estados de porta depende dos temporizadores de BPDU. Somente o switch na função de bridge raiz pode enviar informações por spanning tree para ajustar os temporizadores. Os seguintes temporizadores determinam o desempenho de STP e as mudanças de estado:</p> <p><ul><li>Tempo hello</li><li>Atraso de encaminhamento</li><li>Idade máxima</li></ul></p> <p><b>Clique no botão Funções e Temporizadores na figura.</b></p> <p>Quando o STP está habilitado, cada porta de switch na rede passa pelo estado de bloqueio e os estados transitórios de escuta e aprendizagem em atividade. As portas se estabilizam então para o estado de encaminhamento ou bloqueio, conforme visto no exemplo. Durante uma mudança de topologia, uma porta implementa temporariamente os estados de escuta e aprendizagem por um período especificado chamado <content-link target="{CE91AB5A-A0FC-4952-9CE3-5DE98F93AEF5}" type="glossary">intervalo de atraso de encaminhamento</content-link>.</p> <p>Estes valores permitem o tempo adequado para convergência em uma rede com um diâmetro de switch de sete. Para revisar, o diâmetro de switch é o número de switches que um quadro tem para atravessar para chegar dos dois pontos mais distantes no domínio de broadcast. Um diâmetro de sete switches é o maior diâmetro que o STP permite por causa dos tempos de convergência. A convergência em relação ao spanning tree é o tempo necessário para recalcular o spanning tree se um switch ou link falhar. Você aprenderá como a convergência funciona na próxima seção.</p> <p><b>Clique no botão Configurar diâmetro de rede na figura.</b></p> <p>Recomenda-se que os temporizadores de BPDU não sejam ajustados diretamente porque os valores foram otimizados para o diâmetro de sete switches. O ajuste do valor de diâmetro de spanning tree na bridge raiz para um valor inferior ajusta automaticamente o atraso de encaminhamento e proporcionalmente os temporizadores de idade máximos para o novo diâmetro. Normalmente, você não ajusta os temporizadores de BPDU nem reconfigura o diâmetro de rede. Porém, se, depois de uma pesquisa, um administrador de rede determinou que o tempo de convergência da rede deve ser otimizado, o administrador o faria reconfigurando o diâmetro de rede, não os temporizadores de BPDU.</p> <p>Para configurar um diâmetro de rede diferente para o STP, utilize o comando do modo de configuração global <span class="cmd"><b>spanning-tree vlan </b><i>vlan id</i><b> root primary diameter </b><i>value</i></span> no switch da bridge raiz.</p> <p>No exemplo, o comando do modo de configuração global <span class="cmd"><b>spanning-tree vlan 1 root primary diameter 5</b></span> foi digitado para ajustar o diâmetro de spanning tree para cinco switches.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020503">
<content-media type="InteractiveGraphicRollovers" id="cm3682427112">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020500/tl1305020503/cm3682427112.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020500/tl1305020503/cm3682427112text.xml"/></content-media>
<content-text><p><b>Tecnologia Cisco PortFast</b></p> <p>O PortFast é uma tecnologia da Cisco. Quando uma porta de switch configurada com o PortFast é configurada como uma porta de acesso, aquela porta faz imediatamente a transição do estado de bloqueio para o estado de encaminhamento, ignorando os estados típicos de escuta e aprendizagem do STP. Você pode utilizar o PortFast em portas de acesso, que são conectadas a uma única estação de trabalho ou servidor, para permitir que esses dispositivos sejam conectados a uma rede imediatamente em vez de esperar até que o spanning tree seja convergido. Se uma interface configurada com PortFast recebe um quadro de BPDU, o spanning tree pode colocar a porta no estado de bloqueio utilizando um recurso chamado proteção de BPDU. A configuração da proteção de BPDU está além do escopo deste curso.</p> <p><b>Nota:</b> A tecnologia Cisco PortFast pode ser utilizada para suportar o DHCP. Sem o PortFast, um PC pode enviar uma solicitação DHCP antes de a porta estar no estado de encaminhamento, impedindo o host de adquirir um endereço IP utilizável e outras informações. Como o PortFast altera imediatamente o estado para estado de encaminhamento, o PC sempre obtém um endereço IP utilizável.</p> <p>Para obter mais informações sobre como configurar a proteção de BPDU, consulte:</p> <p><content-link target="http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a008009482f.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a008009482f.shtml</content-link> (em inglês).</p> <p><b>Nota:</b> Como o objetivo do PortFast é diminuir o tempo que as portas de acesso devem esperar para que o spanning tree seja convergido, ele é utilizado somente nas portas de acesso. Se você habilitar o PortFast em uma porta que se conecta a outro switch, existe o risco de criar um loop de spanning tree.</p> <p><b>Clique no botão Configurar PortFast na figura.</b></p> <p>Para configurar o PortFast em uma porta de switch, digite o comando do modo de configuração de interface <span class="cmd"><b>spanning-tree portfast</b></span> em cada interface em que o PortFast deva ser habilitado.</p> <p>Para desabilitar o PortFast, digite o comando do modo de configuração de interface <span class="cmd"><b>no spanning-tree portfast</b></span> em cada interface em que o PortFast deva ser desabilitado.</p> <p><b>Clique no botão Verificar PortFast na figura.</b></p> <p>Para verificar se o PortFast foi habilitado para uma porta de switch, utilize o comando do modo EXEC privilegiado <span class="cmd"><b>show running-config</b></span>. A ausência do comando <span class="cmd"><b>spanning-tree portfast</b></span> na configuração de execução para uma interface indica que o PortFast foi desabilitado para tal interface. PortFast está desabilitado por padrão em todas as interfaces.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020504">
<content-media type="ActivityPKA" id="cm3383025613">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020500/tl1305020504/cm3383025613/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305020000/tl1305020500/tl1305020504/cm3383025613/icontext.xml"/></content-media>
<content-text><p>Nesta atividade, os switches estão "prontos para uso" sem qualquer configuração. Você manipulará a escolha da bridge raiz de forma que os switches de núcleo sejam escolhidos antes dos switches de distribuição ou de camada de acesso.</p> <p>São fornecidas instruções detalhadas na atividade, bem como no link do PDF abaixo.</p> <p><content-link target="E3_PTAct_5_2_5.pdf" type="internalfile">Instruções da Atividade (PDF)</content-link></p> <p><b>Clique no ícone do Packet Tracer para obter mais detalhes.</b></p></content-text>
</page>
</topic>
</section>
<section type="" id="tl1305030000">
<title><content-text>Convergência de STP</content-text></title>
<topic type="" id="tl1305030100">
<title><content-text>Convergência de STP</content-text></title>
<page type="OneColumn" id="tl1305030101">
<content-media type="StaticGraphic" id="cm9852040856">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030100/tl1305030101/cm9852040856.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030100/tl1305030101/cm9852040856text.xml"/></content-media>
<content-text><p><b>Etapas da convergência de STP </b></p> <p>A seção anterior descreveu os componentes que permitem que o STP crie a topologia de rede lógica sem loop. Nesta seção, você examinará o processo de STP inteiro, desde o começo até o fim.</p> <p>A convergência é um aspecto importante do processo de spanning tree. A convergência é o tempo necessário para que a rede determine qual switch vai assumir a função de bridge raiz, o tempo para que ela passe por todos os diferentes estados de porta e defina todas as portas de switch a suas funções de porta de spanning tree finais, onde todos os loops potenciais são eliminados. O processo de convergência demora para ser concluído por causa dos diferentes temporizadores utilizados para coordenar o processo.</p> <p>Para entender o processo de convergência de forma mais completa, ele foi dividido em três etapas diferentes:</p> <p><b>Etapa 1.</b> Eleger uma bridge raiz</p> <p><b>Etapa 2.</b> Eleger portas raiz</p> <p><b>Etapa 3.</b> Eleger portas designadas e não designadas</p> <p>O resto desta seção explora cada etapa no processo de convergência.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305030200">
<title><content-text>Etapa 1. Elegendo uma bridge raiz</content-text></title>
<page type="OneColumn" id="tl1305030201">
<content-media type="InteractiveGraphicRollovers" id="cm6412103216">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030200/tl1305030201/cm6412103216.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030200/tl1305030201/cm6412103216text.xml"/></content-media>
<content-text><p><b>Etapa 1. Elegendo uma bridge raiz</b></p> <p>A primeira etapa do processo de convergência de spanning tree é eleger uma bridge raiz. A bridge raiz é a base para todos os cálculos de custo de caminho do spanning tree e leva basicamente à atribuição das diferentes funções de porta utilizadas para impedir a ocorrência de loops.</p> <p>Uma escolha de bridge raiz é disparada depois que um switch acaba de ser inicializado ou quando uma falha de caminho é detectada em uma rede. Inicialmente, todas as portas de switch são configuradas para o estado de bloqueio que, por padrão, dura 20 segundos. Isto é feito para impedir a ocorrência de um loop antes de o STP ter tempo de calcular os melhores caminhos de raiz e configurar todas as portas de switch em suas funções específicas. Enquanto as portas de switch estiverem em um estado de bloqueio, eles ainda podem enviar e receber quadros de BPDU de forma que a escolha de raiz de spanning tree possa continuar. O spanning tree suporta um diâmetro de rede máximo de sete saltos de switch de fim a fim. Isto permite que o processo de escolha de bridge raiz inteiro ocorra em 14 segundos, menos do que o tempo que as portas de switch gastam no estado de bloqueio. </p> <p>Imediatamente após o término da inicialização dos switches, eles iniciam o envio de quadros de BPDU anunciando seu BID em uma tentativa de tornar-se a bridge raiz. Inicialmente, todos os switches na rede assumem que eles são a bridge raiz para o domínio de broadcast. A inundação de quadros de BPDU na rede faz com que o campo de ID de raiz corresponda ao campo de BID, indicando que cada switch se considera a bridge raiz. Estes quadros de BPDU são enviados a cada 2 segundos com base no valor do temporizador hello padrão.</p> <p>Como cada switch recebe os quadros de BPDU de seus switches vizinhos, eles comparam a ID de raiz do quadro de BPDU recebido com a ID de raiz configurada localmente. Se a ID de raiz do quadro de BPDU recebido for mais baixa que a ID de raiz que possui atualmente, o campo de ID de raiz será atualizado, indicando o novo melhor candidato para a função de bridge raiz.</p> <p>Depois que o campo de ID de raiz é atualizado em um switch, o switch incorpora a nova ID de raiz em todas as transmissões de quadros de BPDU futuras. Isto garante que a ID de raiz mais baixa seja sempre comunicada a todos os outros switches adjacentes na rede. A escolha de bridge raiz termina uma vez que a ID de bridge mais baixa preenche o campo de ID de raiz de todos os switches no domínio de broadcast. </p> <p>Embora o processo de escolha da bridge raiz tenha sido concluído, os switches continuam a encaminhar seus quadros de BPDU anunciando a ID de raiz da bridge raiz a cada 2 segundos. Cada switch é configurado com um temporizador de idade máxima que determina quanto tempo um switch retém a configuração de BPDU atual no caso de ele parar de receber atualizações de seus switches vizinhos. Por padrão, o temporizador de idade máxima é definido em 20 segundos. Portanto, se um switch não recebe 10 quadros de BPDU sucessivos de um de seus vizinhos, o switch assumirá que um caminho lógico no spanning tree falhou e que as informações de BPDU não são mais válidas. Isto dispara outra escolha de bridge raiz de spanning tree.</p> <p><b>Clique no botão Reproduzir na figura</b> para rever as etapas que o STP utiliza para eleger uma bridge raiz.</p> <p>Enquanto você revê como o STP elege uma bridge raiz, lembre-se de que o processo de escolha de bridge raiz ocorre com todos os switches que enviam e recebem quadros de BPDU simultaneamente. Executar o processo de escolha simultaneamente permite que os switches determinem qual switch se tornará a bridge raiz muito mais rápido.</p></content-text>
</page>
<page type="OneColumn" id="tl1305030202">
<content-media type="InteractiveGraphicRollovers" id="cm6607674766">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030200/tl1305030202/cm6607674766.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030200/tl1305030202/cm6607674766text.xml"/></content-media>
<content-text><p><b>Verificar escolha da bridge raiz</b></p> <p>Quando a escolha de bridge raiz for concluída, você poderá verificar a identidade da bridge raiz utilizando o comando de modo EXEC privilegiado <span class="cmd"><b>show spanning-tree</b></span></p> <p>No exemplo da topologia, o switch S1 possui o valor de prioridade mais baixo dos três switches, assim podemos supor que ele se tornará a bridge raiz.</p> <p><b>Clique no botão Saída do comando do switch S1 na figura.</b></p> <p>No exemplo, a saída de dados do comando <span class="cmd"><b>show spanning-tree</b></span> para o switch S1 revela que ele é a bridge raiz. Você pode ver que o BID corresponde à ID de raiz, confirmando que S1 é a bridge raiz.</p> <p><b>Clique no botão Saída do comando do switch S2 na figura.</b></p> <p>No exemplo, a saída de dados do comando <span class="cmd"><b>show spanning-tree</b></span> para o switch S2 mostra que a ID de raiz corresponde à ID de raiz esperada do switch S1, indicando que S2 considera S1 como a bridge raiz.</p> <p><b>Clique no botão Saída do comando do switch S3 na figura.</b></p> <p>No exemplo, a saída de dados do comando <span class="cmd"><b>show spanning-tree</b></span> para o switch S3 mostra que a ID de raiz corresponde à ID de raiz esperada do switch S1, indicando que S3 considera S1 como a bridge raiz.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305030300">
<title><content-text>Etapa 2. Eleger portas raiz</content-text></title>
<page type="OneColumn" id="tl1305030301">
<content-media type="StaticGraphic" id="cm4139731900">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030300/tl1305030301/cm4139731900.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030300/tl1305030301/cm4139731900text.xml"/></content-media>
<content-text><p><b>Etapa 2. Eleger portas raiz</b></p> <p>Agora que a bridge raiz foi determinada, os switches iniciam a configuração das funções de porta para cada uma de suas portas de switch. A primeira função de porta que precisa ser determinada é a função de porta raiz.</p> <p>Cada switch em uma topologia spanning-tree, exceto a bridge raiz, possui uma única porta raiz definida. A porta raiz é a porta de switch com o custo de caminho mais baixo para a bridge raiz. Normalmente só o custo de caminho determina qual porta de switch se torna a porta raiz. Porém, características adicionais de porta determinam a porta raiz quando duas ou mais portas no mesmo switch tiverem o mesmo custo de caminho até a raiz. Isto pode acontecer quando são utilizados links redundantes para realizar um uplink de um switch para outro quando uma configuração EtherChannel não for utilizada. Lembre-se de que a tecnologia Cisco EtherChannel permite que você configure diversos links físicos do tipo Ethernet como um link lógico.</p> <p>As portas de switch com custos de caminho equivalentes para a raiz utilizam o valor de prioridade de porta configurável. Elas utilizam a ID de porta para a determinação final. Quando um switch escolhe uma porta de custo de caminho igual em vez de outro, a porta que perdeu é configurada como a não-designada para evitar um loop.</p> <p>O processo de determinar qual porta se torna uma porta raiz acontece durante a troca de BPDU de escolha de bridge raiz. Os custos de caminho são imediatamente atualizados quando os quadros de BPDU chegam, indicando uma nova ID de raiz ou caminho redundante. Quando o custo de caminho é atualizado, o switch entra em modo de decisão para determinar se as configurações de porta precisam ser atualizadas. As decisões de função de porta não esperam até que todos os switches resolvam qual switch será a bridge raiz final. Desse modo, a função de porta para uma determinada porta de switch pode mudar várias vezes durante a convergência, até que se resolva finalmente sua função de porta final após a ID de raiz mudar pela última vez.</p> <p><b>Clique em cada etapa na figura</b> para obter informações sobre a escolha dasportas raiz.</p></content-text>
</page>
<page type="OneColumn" id="tl1305030302">
<content-media type="InteractiveGraphicRollovers" id="cm6663861202">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030300/tl1305030302/cm6663861202.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030300/tl1305030302/cm6663861202text.xml"/></content-media>
<content-text><p><b>Verificar a porta raiz</b></p> <p>Quando a escolha de bridge raiz for concluída, você poderá verificar a configuração dasportas raiz utilizando o comando do modo EXEC privilegiado <span class="cmd"><b>show spanning-tree</b></span>.</p> <p>No exemplo de topologia, o switch S1 foi identificado como a bridge raiz. A porta F0/1 do switch S2 e a porta F0/1 do switch S3 são as duas portas mais próximas da bridge raiz e, portanto, devem ser configuradas comoportas raiz. Você pode confirmar a configuração de porta utilizando o comando do modo EXEC privilegiado <span class="cmd"><b>show spanning-tree</b></span>.</p> <p><b>Clique no botão Saída do comando do switch S1 na figura.</b></p> <p>No exemplo, a saída do comando <span class="cmd"><b>show spanning-tree</b></span> para o switch S1 revela que ele é a bridge raiz e, conseqüentemente, não possui nenhuma porta raiz configurada.</p> <p><b>Clique no botão Saída do comando do switch S2 na figura. </b></p> <p>No exemplo, a saída de dados do comando <span class="cmd"><b>show spanning-tree</b></span> para o switch S2 mostra que a porta F0/1 do switch está configurada como uma porta raiz. A ID de raiz mostra a Prioridade e o Endereço MAC do switch S1. </p> <p><b>Clique no botão Saída do comando do switch S3 na figura. </b></p> <p>No exemplo, a saída do comando <span class="cmd"><b>show spanning-tree</b></span> para o switch S3 mostra que a porta F0/1 do switch está configurada como a porta raiz. A ID de raiz mostra a Prioridade e o Endereço MAC do switch S1. </p></content-text>
</page>
</topic>
<topic type="" id="tl1305030400">
<title><content-text>Etapa 3. Elegendo portas designadas e portas não-designadas</content-text></title>
<page type="OneColumn" id="tl1305030401">
<content-media type="StaticGraphic" id="cm4305433573">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030400/tl1305030401/cm4305433573.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030400/tl1305030401/cm4305433573text.xml"/></content-media>
<content-text><p><b>Etapa 3. Elegendo portas designadas e portas não-designadas</b></p> <p>Depois que um switch determina quais de suas portas é a porta raiz, as portas restantes devem ser configuradas como porta designada (DP) ou porta não-designada (não-DP) para concluir a criação do spanning tree lógico sem loop.</p> <p>Cada segmento em uma rede comutada pode ter somente uma porta designada. Quando duas portas de switch de porta não-raiz são conectadas ao mesmo segmento de rede local, ocorre uma competição pelas funções de porta. O dois switches trocam quadros de BPDU para classificar qual porta de switch será designada e qual será a não-designada.</p> <p>Geralmente, quando uma porta de switch está configurada como uma porta designada, isto se baseia no BID. Porém, lembre-se de que a primeira prioridade é o custo de caminho mais baixo para a bridge raiz e que, somente se os custos de porta forem iguais, o BID do remetente será utilizado. </p> <p>Quando dois switches trocam seus quadros de BPDU, eles examinam o BID de envio do quadro de BPDU recebido para ver se ele é inferior ao seu próprio BID. O switch com o BID mais baixo ganha a competição e sua porta é configurada na função designada. O switch perdedor configura sua porta de switch como não-designada e, portanto, no estado de bloqueio para impedir que ocorram loops.</p> <p>O processo de determinar as funções de porta acontece ao mesmo tempo que a escolha da bridge raiz e da designação de porta raiz. Desse modo, as funções designadas e não-designadas podem mudar diversas vezes durante o processo de convergência até que a bridge raiz final seja determinada. O processo inteiro de eleger a bridge raiz, determinar asportas raiz e determinar as portas designadas e não-designadas acontece dentro do estado da porta de bloqueio de 20 segundos. Este tempo de convergência se baseia no temporizador hello de dois segundos para a transmissão de quadros de BPDU e no diâmetro de sete switches suportado pelo STP. O atraso de idade de máximo de 20 segundos fornece tempo suficiente para o diâmetro de sete switches com o temporizador hello de dois segundos entre as transmissões de quadros de BPDU.</p> <p><b>Clique em cada etapa na figura</b> para obter informações sobre a escolha das portas designadas e portas não-designadas.</p></content-text>
</page>
<page type="OneColumn" id="tl1305030402">
<content-media type="InteractiveGraphicRollovers" id="cm9994647066">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030400/tl1305030402/cm9994647066.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030400/tl1305030402/cm9994647066text.xml"/></content-media>
<content-text><p><b>Verificar DP e não-DP</b></p> <p>Depois que asportas raiz foram atribuídas, os switches determinam quais portas restantes são configuradas como portas designadas e não-designadas. Você pode verificar a configuração das portas designadas e não-designadas utilizando o comando do modo EXEC privilegiado <span class="cmd"><b>show spanning-tree</b></span>.</p> <p>Na topologia:</p> <p>1. O switch S1 é identificado como a bridge raiz e, portanto, configura ambas as suas portas de switch como portas designadas. </p> <p>2. A porta F0/1 do switch S2 e a porta F0/1 do switch S3 são as duas portas mais próximas da bridge raiz e são configuradas comoportas raiz. </p> <p>3. As portas restantes F0/2 do switch S2 e F0/2 do switch S3 precisam decidir quais das duas portas restantes serão a porta designada e a porta não-designada. </p> <p>4. O switch S2 e switch S3 comparam os valores de BID para determinar qual é o mais baixo. Aquele com o BID mais baixo é configurado como a porta designada. </p> <p>5. Como ambos os switches possuem a mesma prioridade, o endereço MAC se torna o fator decisivo. </p> <p>6. Como o switch S2 possui um endereço MAC inferior, ele configura sua porta F0/2 como uma porta designada. </p> <p>7. Como conseqüência, o switch S3 configura sua porta F0/2 como uma porta não-designada para impedir a ocorrência de loop. </p> <p>Você pode confirmar a configuração de porta utilizando o comando do modo EXEC privilegiado show spanning-tree.</p> <p><b>Clique no botão Saída do comando do switch S1 na figura.</b></p> <p>No exemplo, a saída do comando <span class="cmd"><b>show spanning-tree</b></span> para o switch S1 revela que ele é a bridge raiz e, conseqüentemente, possui ambas as suas portas configuradas como portas designadas.</p> <p><b>Clique no botão Saída do comando do switch S2 na figura.</b></p> <p>No exemplo, a saída de dados do comando <span class="cmd"><b>show spanning-tree</b></span> para o switch S2 mostra que a porta F0/2 do switch está configurada como uma porta designada.</p> <p><b>Clique no botão Saída do comando do switch S3 na figura.</b></p> <p>No exemplo, a saída de dados do comando <span class="cmd"><b>show spanning-tree</b></span> para o switch S3 mostra que a porta F0/2 do switch está configurada como uma porta não-designada.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305030500">
<title><content-text>Mudança na topologia de STP</content-text></title>
<page type="OneColumn" id="tl1305030501">
<content-media type="InteractiveGraphicRollovers" id="cm6316113290">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030500/tl1305030501/cm6316113290.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030500/tl1305030501/cm6316113290text.xml"/></content-media>
<content-text><p><b>Processo de notificação de mudança na topologia de STP</b></p> <p>Um switch considera que detectou uma mudança na topologia quando uma porta que estava encaminhando torna-se inativa (por exemplo, em estado de bloqueio) ou quando uma porta faz a transição para o estado de encaminhamento e o switch tiver uma porta designada. Quando uma mudança é detectada, o switch notifica a bridge raiz do spanning tree. A bridge raiz transmite, então, as informações em broadcast por toda a rede.</p> <p>Em operação de STP normal, um switch continua recebendo configuração de quadros de BPDU da bridge raiz em sua porta raiz. Porém, ele nunca envia um BPDU para a bridge raiz. Para que isso aconteça, um BPDU especial chamado de BPDU de notificação de mudança de topologia (Topology, Change Notification, TCN) foi introduzido. Quando um switch precisa sinalizar uma mudança na topologia, ele começa a enviar TCNs em sua porta raiz. O TCN é um BPDU muito simples que não contém nenhuma informação e é enviado no intervalo de tempo hello. O switch de recebimento é chamado de bridge designada e reconhece o TCN pelo envio imediato de um BPDU normal com o conjunto de bits de confirmação de mudança na topologia (Topology Change Acknowledgement, TCA). Esta troca continua até que a bridge raiz responda.</p> <p>Por exemplo, na figura, o switch S2 passa por uma mudança na topologia. Ele envia um TCN para sua bridge designada que, neste caso, é o switch D1. O switch D1 recebe o TCN e o confirma para o switch S2 com um TCA. O switch D1 gera um TCN e o encaminha para sua bridge designada que, neste caso, é a bridge raiz. </p> <p><b>Clique no botão Notificação de Broadcast na figura.</b></p> <p><b>Notificação de broadcast</b></p> <p>Quando a bridge raiz fica sabendo que houve um evento de mudança de topologia na rede, ele começa a enviar seus BPDUs de configuração com o conjunto de bits de mudança de topologia (TC). Estes BPDUs são retransmitidos por todos os switches na rede com este conjunto de bits. Como resultado, todos os switches ficam cientes da mudança na topologia e podem reduzir seu tempo de validade para o atraso de encaminhamento. Os switches recebem os BPDUs de mudança de topologia em ambas as portas de encaminhamento e bloqueio.</p> <p>O bit de TC é definido pela raiz por um período máximo de idade + segundos de atraso de encaminhamento, que são, por padrão, 20+15=35 segundos.</p></content-text>
</page>
</topic>
</section>
<section type="" id="tl1305040000">
<title><content-text>PVST+, RSTP e Rapid-PVST+</content-text></title>
<topic type="" id="tl1305040100">
<title><content-text>Cisco e as variantes de STP</content-text></title>
<page type="OneColumn" id="tl1305040101">
<content-media type="StaticGraphic" id="cm7529133937">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040100/tl1305040101/cm7529133937.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040100/tl1305040101/cm7529133937text.xml"/></content-media>
<content-text><p>Como muitos padrões de rede, a evolução de STP foi orientada pela necessidade de criar especificações em toda a indústria quando os protocolos proprietários se tornaram <content-link target="{E2DB50CF-7AB3-4403-AD48-05AA1DA1907E}" type="glossary">normas de facto</content-link>. Quando um protocolo proprietário se torna superior, todos os concorrentes no mercado precisam suportá-lo, e agências como o IEEE intervêm e criam uma especificação pública. A evolução do STP seguiu este mesmo caminho, conforme visto na tabela. </p> <p>Quando você lê sobre o STP no site Cisco.com, percebe que existem muitos tipos de variantes do STP. Algumas destas variantes são de propriedade da Cisco e outras são padrões do IEEE. Você obterá mais detalhes sobre algumas destas variantes de STP, mas, para iniciar, você precisa ter um conhecimento geral do que são as principais variantes de STP. A tabela resume as seguintes descrições das principais variantes de STP da Cisco e do IEEE.</p> <p><b>Propriedade da Cisco</b></p> <p><b>Protocolo por spanning tree de VLAN (PVST)</b> - Mantém uma instância de spanning tree para cada VLAN configurada na rede. Ele utiliza um protocolo de entroncamento ISL de propriedade da Cisco que permite que um tronco de VLAN encaminhe para algumas VLANs enquanto bloqueia para outras VLANs. Como o PVST trata cada VLAN como uma rede separada, ele pode fazer o <content-link target="{6486955C-ABEA-42FA-8513-891B95FCF479}" type="glossary">balanceamento de carga</content-link> na Camada 2 encaminhando algumas VLANs em um tronco e outras VLANs em outro tronco sem causar um loop. Para o PVST, a Cisco desenvolveu diversas extensões proprietárias ao STP 802.1D do IEEE original, como o BackboneFast, UplinkFast e PortFast. Estas extensões de STP da Cisco não são abordadas neste curso. Para obter mais informações sobre estas extensões, visite <content-link target="http://www.cisco.com/en/US/docs/switches/lan/catalyst4000/7.4/configuration/guide/stp_enha.html" type="external">http://www.cisco.com/en/US/docs/switches/lan/catalyst4000/7.4/configuration/guide/stp_enha.html</content-link> (em inglês). </p> <p><b>Protocolo spanning tree por-VLAN plus (PVST+)</b> - a Cisco desenvolveu o PVST+ para fornecer suporte ao entroncamento do 802.1Q de IEEE. O PVST+ fornece a mesma funcionalidade que o PVST, incluindo as extensões de STP de propriedade da Cisco. O PVST+ não é suportado em dispositivos que não sejam da Cisco. O PVST+ inclui o aprimoramento do PortFast chamado de proteção de BPDU e proteção de raiz. Para obter mais informações sobre a proteção de BPDU, visite: <content-link target="http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a008009482f.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a008009482f.shtml</content-link> (em inglês).</p> <p>Para obter mais informações sobre a proteção de raiz, visite: <content-link target="http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a00800ae96b.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a00800ae96b.shtml</content-link> (em inglês).</p> <p><b>Protocolo spanning tree por VLAN Rápido (rapid-PVST+)</b> - Baseado no padrão 802.1w do IEEE e possui uma convergência mais rápida do que STP (padrão 802.1D). O Rapid-PVST+ inclui extensões de propriedade da Cisco como o BackboneFast, UplinkFast e PortFast.</p> <p><b>Padrões IEEE</b></p> <p><b>Protocolo spanning tree rápido (RSTP)</b> - Introduzido pela primeira vez em 1982 como uma evolução do STP (802.1D padrão). Ele fornece uma convergência de spanning tree mais rápida depois de uma mudança de topologia. O RSTP implementa, no padrão público, as extensões de STP de propriedade da Cisco, o BackboneFast, UplinkFast e PortFast. A partir de 2004, o IEEE incorporou o RSTP no 802.1D, identificando a especificação como IEEE 802.1D-2004. Assim, quando você ouvir falar em STP, pense no RSTP. Você obterá mais informações sobre o RSTP posteriormente nesta seção.</p> <p><b>STP Múltiplo (MSTP)</b> - Permite que várias VLANs sejam mapeadas para a mesma instância de spanning tree, reduzindo o número de instâncias necessárias para suportar um grande número de VLANs. O MSTP foi inspirado pelo STP de Instâncias Múltiplas (MISTP) de propriedade da Cisco e se trata de uma evolução do STP e RSTP. Ele foi introduzido no IEEE 802.1s como uma emenda ao 802.1Q, edição de 1998. O IEEE 802.1Q-2003 padrão inclui agora o MSTP. O MSTP fornece diversos caminhos de encaminhamento para o tráfego de dados e permite o balanceamento de carga. Uma discussão sobre o MSTP está além do escopo deste curso. Para obter mais informações sobre o MSTP, visite <content-link target="http://www.cisco.com/en/US/docs/switches/lan/catalyst2950/software/release/12.1_19_ea1/configuration/guide/swmstp.html" type="external">http://www.cisco.com/en/US/docs/switches/lan/catalyst2950/software/release/12.1_19_ea1/configuration/guide/swmstp.html</content-link> (em inglês).</p></content-text>
</page>
</topic>
<topic type="" id="tl1305040200">
<title><content-text>PVST+</content-text></title>
<page type="OneColumn" id="tl1305040201">
<content-media type="StaticGraphic" id="cm5207024464">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040200/tl1305040201/cm5207024464.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040200/tl1305040201/cm5207024464text.xml"/></content-media>
<content-text><p><b>PVST+</b></p> <p>A Cisco desenvolveu o PVST+ de forma que uma rede possa executar uma instância de STP para cada VLAN na rede. Com o PVST+, mais de um tronco pode bloquear para uma VLAN e o compartilhamento de carga pode ser implementado. Entretanto, implementar o PVST+ significa que todos os switches na rede estão ocupados em convergir a rede e as portas do switch precisam acomodar a largura de banda adicional utilizada para cada instância de PVST+ para enviar seus próprios BPDUs. </p> <p>Em um ambiente Cisco PVST+, você pode ajustar os parâmetros de spanning tree de forma que metade das VLANs encaminhe cada tronco de uplink. Na figura, a porta F0/3 no switch S2 é a porta de encaminhamento para a VLAN 20 e a porta F0/2 no switch S2 é a porta de encaminhamento para a VLAN 10. Isto é realizado configurando um switch para ser escolhido a bridge raiz para metade do número total de VLANs na rede e um segundo switch para ser escolhido a bridge raiz para a outra metade das VLANs. Na figura, o switch S3 é a bridge raiz para a VLAN 20 e o switch S1 é a bridge raiz para a VLAN 10. Criar switches de raiz de STP diferentes por VLAN cria uma rede mais redundante. </p></content-text>
</page>
<page type="OneColumn" id="tl1305040202">
<content-media type="StaticGraphic" id="cm4119860280">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040200/tl1305040202/cm4119860280.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040200/tl1305040202/cm4119860280text.xml"/></content-media>
<content-text><p><b>ID da bridge de PVST+</b></p> <p>Como você se lembra, no padrão do 802.1D original, um BID de 8 bytes é composto de uma prioridade de bridge de 2 bytes e um endereço MAC de 6 bytes do switch. Não havia necessidade de identificar uma VLAN porque havia somente um spanning tree em uma rede. O PVST+ requer que uma instância separada de spanning tree seja executada para cada VLAN. Para suportar o PVST+, o campo de BID de 8 bytes é modificado para levar uma ID de VLAN (VID). Na figura, o campo de prioridade de bridge é reduzido a 4 bits e um novo campo de 12 bits, o campo de ID de sistema, contém o VID. O endereço MAC de 6 bytes permanece inalterado. </p> <p>A seguir, fornecemos mais detalhes sobre os campos de PVST+:</p> <p><ul><li>Prioridade de bridge – Um campo de 4 bits que leva a prioridade de bridge. Devido à contagem limitada de bits, a prioridade é comunicada em valores discretos em acréscimos de 4096 em vez de valores discretos em acréscimos de 1, como seriam se o campo de 16 bits inteiro estivesse disponível. A prioridade padrão, conforme o IEEE 802.1D, é de 32.768, que é o valor médio.</li><li>ID de sistema estendido - Um campo de 12 bits que leva o VID para PVST+. </li><li>Endereço MAC - Um campo de 6 bytes com o endereço MAC de um único switch. </li></ul></p> <p>O endereço MAC é o que torna o BID exclusivo. Quando a prioridade e a ID de sistema estendido são incluídas desde o início ao endereço MAC do switch, cada VLAN no switch pode ser representada por um BID exclusivo. </p> <p><b>Clique no botão Exemplo de ID de bridge de PVST+ na figura.</b></p> <p>Na figura, são mostrados os valores para prioridade, VLAN e endereço MAC para o switch S1. Eles são combinados para formar o BID.</p> <p><b>Cuidado:</b>Se nenhuma prioridade foi configurada, todos os switches terão a mesma prioridade padrão e a escolha da bridge raiz para cada VLAN se baseia no endereço MAC. Portanto, para assegurar que você obtenha a bridge raiz que deseja, aconselha-se atribuir um valor de prioridade inferior ao switch que deve servir como a bridge raiz.</p></content-text>
</page>
<page type="OneColumn" id="tl1305040203">
<content-media type="StaticGraphic" id="cm4046248871">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040200/tl1305040203/cm4046248871.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040200/tl1305040203/cm4046248871text.xml"/></content-media>
<content-text><p>A tabela mostra a configuração de spanning tree padrão para um switch da série Cisco Catalyst 2960. Observe que o modo padrão de spanning tree é o PVST+.</p></content-text>
</page>
<page type="OneColumn" id="tl1305040204">
<content-media type="InteractiveGraphicRollovers" id="cm2329173336">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040200/tl1305040204/cm2329173336.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040200/tl1305040204/cm2329173336text.xml"/></content-media>
<content-text><p><b>Configurar PVST+</b></p> <p>A topologia mostra três switches conectados com troncos de 802.1Q. Existem duas VLANs, 10 e 20, que estão sendo entroncadas através destes links. Esta rede não foi configurada para spanning tree. O objetivo é configurar S3 como a bridge raiz para a VLAN 20 e S1 como a bridge raiz para a VLAN 10. A porta F0/3 em S2 é a porta de encaminhamento para a VLAN 20 e a porta de bloqueio para a VLAN 10. A porta F0/2 em S2 é a porta de encaminhamento para a VLAN 10 e a porta de bloqueio para a VLAN 20. As etapas para configurar o PVST+ nesta topologia de exemplo são:</p> <p><b>Etapa 1.</b> Selecione os switches que você deseja que sejam as bridges de raiz primária e secundária para cada VLAN.</p> <p><b>Etapa 2.</b> Configure o switch para ser uma bridge primária para uma VLAN, por exemplo, o switch S3, que é uma bridge primária para a VLAN 20.</p> <p><b>Etapa 3.</b> Configure o switch para ser uma bridge secundária para a outra VLAN, por exemplo, o switch S3, que é uma bridge secundária para a VLAN 10.</p> <p>Opcionalmente, defina a prioridade de spanning tree para ser baixa o bastante em cada switch de forma que ela seja selecionada como a bridge primária.</p> <p><b>Clique no botão Bridges de raiz primária e secundária na figura.</b></p> <p><b>Configurar as Bridges de Raiz Primárias</b></p> <p>O objetivo é configurar o switch S3 como a bridge raiz primária para a VLAN 20 e configurar o switch S1 como a bridge raiz primária para a VLAN 10. Para configurar um switch de modo que ele se torne a bridge raiz para uma VLAN específica, utilize o comando do modo de configuração global <span class="cmd"><b>spanning-tree vlan </b><i>vlan-ID</i><b> root primary</b></span>. Lembre-se de que você está começando com uma rede que não foi configurada com o spanning tree, assim suponha que todos os switches estejam em sua configuração padrão. Neste exemplo, o switch S1, que está com as VLANs 10 e 20 habilitadas, retém sua prioridade de STP padrão.</p> <p><b>Configurar as Bridges de Raiz Secundárias</b></p> <p>Uma raiz secundária é um switch que pode se tornar a bridge raiz para uma VLAN se a bridge raiz primária falhar. Para configurar um switch como a bridge raiz secundária, utilize o comando do modo de configuração global <span class="cmd"><b>spanning-tree vlan </b><i>vlan-ID</i><b> root secondary</b></span>. Supondo que as outras bridges na VLAN retêm sua prioridade de STP padrão, este switch se torna a bridge raiz se a bridge raiz primária falhar. Este comando pode ser executado em mais de um switch para configurar diversas bridges de raiz de backup.</p> <p>O gráfico mostra a sintaxe do comando Cisco IOS para especificar o switch S3 como a bridge raiz primária para a VLAN 20 e como a bridge raiz secundária para a VLAN 10. Além disso, o switch S1 se torna a bridge raiz primária para a VLAN 10 e a bridge raiz secundária para a VLAN 20. Esta configuração permite o balanceamento de carga de spanning tree, com o tráfego da VLAN 10 passando através do switch S1 e o tráfego da VLAN 20 passando pelo switch S3.</p> <p><b>Clique no botão Prioridade do switch de PVST+ na figura.</b></p> <p><b>Prioridade do switch de PVST+</b></p> <p>Você aprendeu anteriormente neste capítulo que as configurações padrão utilizadas para configurar o spanning tree são adequadas para a maioria das redes. Isto também é válido para o Cisco PVST+. Existem várias formas de ajustar o PVST+. Uma discussão sobre como ajustar uma implementação de PVST+ está além do escopo deste curso. Porém, você pode definir a prioridade do switch para a instância de spanning tree especificada. Esta configuração afeta a probabilidade de este switch ser selecionado como o switch de raiz. Um valor inferior aumenta a probabilidade de o switch ser selecionado. O intervalo é de 0 a 61440 em acréscimos de 4096. Por exemplo, um valor de prioridade válido é 4096x2 = 8192. Todos os outros valores são rejeitados. </p> <p>Os exemplos mostram a sintaxe de comando do Cisco IOS. </p> <p><b>Clique no botão Verificar na figura.</b></p> <p>O comando EXEC privilegiado <span class="cmd"><b>show spanning tree active</b></span> mostra os detalhes de configuração de spanning tree somente para as interfaces ativas. A saída de dados mostrada é do switch S1 configurado com PVST+. Existem muitos parâmetros de comando do Cisco IOS associados ao comando <span class="cmd"><b>show spanning tree</b></span>. Para obter uma descrição completa, visite: <content-link target="http://www.cisco.com/en/US/docs/switches/lan/catalyst2960/software/release/12.2_37_se/command/reference/cli2.html#wpxref47293" type="external">http://www.cisco.com/en/US/docs/switches/lan/catalyst2960/software/release/12.2_37_se/command/reference/cli2.html#wpxref47293</content-link>.</p> <p><b>Clique no botão </b><span class="cmd"><b>show run</b></span><b> na figura.</b></p> <p>Você pode ver na saída de dados que a prioridade para a VLAN 10 é 4096, a mais baixa das três prioridades de VLAN. Esta configuração de prioridade assegura que este switch seja a bridge raiz primária para a VLAN 10.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305040300">
<title><content-text>RSTP</content-text></title>
<page type="OneColumn" id="tl1305040301">
<content-media type="InteractiveGraphicRollovers" id="cm8106262651">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040300/tl1305040301/cm8106262651.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040300/tl1305040301/cm8106262651text.xml"/></content-media>
<content-text><p><b>O que é RSTP?</b></p> <p>O RSTP (IEEE 802.1w) é uma evolução do 802.1D padrão. A terminologia de STP do 802.1w permanece essencialmente igual à terminologia de STP do IEEE 802.1D. A maioria dos parâmetros permaneceu inalterada, assim os usuários familiarizados com o STP podem configurar rapidamente o novo protocolo. </p> <p>Na figura, uma rede mostra um exemplo de RSTP. O switch S1 é a bridge raiz com duas portas designadas em um estado de encaminhamento. O RSTP suporta um novo tipo de porta. A porta F0/3 no switch S2 é uma porta alternativa no estado de descarte. Observe que não há nenhuma porta de bloqueio. O RSTP não possui um estado de porta de bloqueio. Ele define os estados de porta como descarte, aprendizagem ou encaminhamento. Você obterá mais informações sobre os tipos de porta posteriormente no capítulo.</p> <p><b>Clique no botão Características de RSTP na figura.</b></p> <p><b>Características do RSTP</b></p> <p>O RSTP adianta o novo cálculo do spanning tree quando a topologia de rede de Camada 2 é alterada. O RSTP pode obter uma convergência muito mais rápida em uma rede corretamente configurada, às vezes em menos de cem milésimos de segundos. O RSTP redefine o tipo de portas e seus estados. Se uma porta for configurada como uma porta alternativa ou de backup, ela pode mudar imediatamente para um estado de encaminhamento sem esperar que a rede seja convergida. Descreve-se brevemente, a seguir, as características de RSTP:</p> <p><ul><li>O RSTP é o protocolo preferido para impedir loops de Camada 2 em um ambiente de rede comutado. Muitas das diferenças foram informadas pelas melhorias de propriedade da Cisco para o 802.1D. Tais melhorias, como o carregamento e o envio de informações pelos BPDUs sobre as funções de porta para switches vizinhos, não exigem nenhuma configuração adicional e geralmente são melhor executadas do que nas versões anteriores de propriedade da Cisco. Elas são, agora, transparentes e integradas na operação do protocolo. </li><li>As melhorias de propriedade da Cisco ao 802.1D, como o UplinkFast e BackboneFast, não são compatíveis com o RSTP.</li><li>O RSTP (802.1w) substitui o STP (802.1D) ao mesmo tempo em que mantém a compatibilidade com versões anteriores. Grande parte da terminologia de STP permanece e a maioria dos parâmetros está inalterada. Além disso, o 802.1w pode ser revertido novamente para 802.1D para interoperar com switches herdados por porta. Por exemplo, o algoritmo spanning tree (STA) de RSTP elege uma bridge raiz exatamente do mesmo modo que o 802.1D. </li><li>O RSTP mantém o mesmo formato de BPDU que o IEEE 802.1D, a não ser pelo campo de versão, definido como 2 para indicar RSTP, e o campo de flags, que utiliza todos os 8 bits. O BPDU de RSTP é discutido posteriormente.</li><li>O RSTP é capaz de confirmar ativamente que uma porta pode fazer a transição de modo seguro para o estado de encaminhamento sem ter que confiar em qualquer configuração de temporizador.</li></ul></p></content-text>
</page>
<page type="OneColumn" id="tl1305040302">
<content-media type="StaticGraphic" id="cm3472076048">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040300/tl1305040302/cm3472076048.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040300/tl1305040302/cm3472076048text.xml"/></content-media>
<content-text><p><b>BPDU de RSTP</b></p> <p>O RSTP (802.1w) utiliza os BPDUs de tipo 2 da versão 2, assim uma bridge de RSTP pode comunicar-se com 802.1D em qualquer link compartilhado ou com qualquer switch que execute o 802.1D. O RSTP envia BPDUs e preenche o byte de flag de uma maneira ligeiramente diferente do que no 802.1D:</p> <p><ul><li>As informações de protocolo podem expirar imediatamente em uma porta se os hellos não forem recebidos para três temporizadores hello consecutivos, 6 segundos por padrão, ou se o temporizador de idade máxima expirar. </li><li>Como os BPDUs são utilizados como um mecanismo keepalive, três BPDUs perdidos consecutivamente indicam perda de conectividade entre uma bridge e sua raiz de vizinho ou bridge designada. A rápida duração das informações permite que as falhas sejam rapidamente detectadas.</li></ul></p> <p><b>Nota: </b>Como no STP, uma bridge de RSTP envia um BPDU com suas informações atuais a cada período de tempo hello (2 segundos, por padrão), mesmo se a bridge de RSTP não receber nenhum BPDU da bridge raiz. </p> <p>O RSTP utiliza o byte de flag do BPDU de versão 2 conforme mostrado na figura:</p> <p><ul><li>Os bits 0 e 7 são utilizados para a mudança de topologia e <content-link target="{5BD1CB6F-D813-41FC-957A-674825DFA6C6}" type="glossary">confirmação (ACK)</content-link> como no 802.1D. </li><li>Os bits 1 e 6 são utilizados para o processo de Acordo de Proposta (utilizado para convergência rápida).</li><li>Os bits 2-5 codificam a função e o estado da porta que origina o BPDU.</li><li>Os bits 4 e 5 são utilizados para codificar a função de porta utilizando um código de 2 bits.</li></ul></p></content-text>
</page>
</topic>
<topic type="" id="tl1305040400">
<title><content-text>Portas de extremidade</content-text></title>
<page type="OneColumn" id="tl1305040401">
<content-media type="InteractiveGraphicRollovers" id="cm7199801801">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040400/tl1305040401/cm7199801801.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040400/tl1305040401/cm7199801801text.xml"/></content-media>
<content-text><p><b>Portas de extremidade</b></p> <p>Uma porta de extremidade de RSTP é uma porta de switch cujo destino nunca é a conexão a outro dispositivo de switch. Ela faz a transição imediatamente para o estado de encaminhamento quando habilitada. </p> <p>O conceito de extremidade de porta é muito conhecido pelos usuários de spanning tree da Cisco, porque ele corresponde ao recurso de PortFast no qual todas as portas diretamente conectadas a estações finais antecipam que nenhum dispositivo de switch está conectado a eles. As portas do PortFast fazem imediatamente a transição para o estado de encaminhamento de STP, enquanto pulam os estágios demorados de escuta e aprendizagem. As portas de extremidade e as portas habilitadas para PortFast não geram mudanças de topologia quando a porta faz a transição para um status desabilitado ou habilitado.</p> <p>Diferentemente do PortFast, uma porta de extremidade de RSTP que recebe um BPDU perde imediatamente seu status de porta de extremidade e se torna uma porta de spanning tree normal. </p> <p>A implementação de Cisco RSTP mantém a palavra-chave PortFast utilizando o comando <span class="cmd"><b>spanning-tree portfast</b></span> para configuração de porta de extremidade. Desse modo, faz-se uma transição geral de rede para RSTP de uma maneira mais contínua. A configuração de uma porta de extremidade para ser anexada a outro switch pode resultar em implicações negativas para o RSTP quando ele estiver em estado de sincronização, uma vez que um loop temporário pode resultar, possivelmente, no atraso da convergência de RSTP devido à contenção do BPDU com tráfego de loop.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305040500">
<title><content-text>Tipos de link</content-text></title>
<page type="OneColumn" id="tl1305040501">
<content-media type="InteractiveGraphicRollovers" id="cm7881346778">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040500/tl1305040501/cm7881346778.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040500/tl1305040501/cm7881346778text.xml"/></content-media>
<content-text><p><b>Tipos de link</b></p> <p>O tipo de link fornece uma categorização para cada porta que participa de RSTP. O tipo de link pode pré-determinar a função ativa que a porta desempenha enquanto ele espera a transição imediata para o estado de encaminhamento caso certas condições sejam atendidas. Estas condições são diferentes para portas de extremidade e portas de não-extremidade. As portas de não-extremidade são classificadas em dois tipos de link, ponto-a-ponto e compartilhado. O tipo de link é determinado automaticamente, mas pode ser substituído com uma configuração de porta explícita.</p> <p>As portas de extremidade, as equivalentes às portas habilitadas por PortFast, e os links ponto-a-ponto são os candidatos para a transição rápida para um estado de encaminhamento. Entretanto, antes de o parâmetro de tipo de link ser considerado, o RSTP deve determinar a função de porta. Você obterá mais informações sobre as funções de porta adiante, mas saiba por enquanto que:</p> <p><ul><li>Asportas raiz não utilizam o parâmetro de tipo de link. Asportas raiz podem realizar uma transição rápida para o estado de encaminhamento assim que a porta estiver em sincronização.</li><li>As portas alternativas e de backup não utilizam o parâmetro de tipo de link na maioria dos casos. </li><li>As portas designadas utilizam o máximo do parâmetro de tipo de link. A transição rápida para o estado de encaminhamento para a porta designada ocorrerá somente se o parâmetro de tipo de link indicar um link ponto-a-ponto.</li></ul></p></content-text>
</page>
</topic>
<topic type="" id="tl1305040600">
<title><content-text>Estados de porta e funções de porta de RSTP</content-text></title>
<page type="OneColumn" id="tl1305040601">
<content-media type="InteractiveGraphicRollovers" id="cm2421624064">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040600/tl1305040601/cm2421624064.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040600/tl1305040601/cm2421624064text.xml"/></content-media>
<content-text><p><b>Estados de porta de RSTP</b></p> <p>O RSTP fornece uma rápida convergência após uma falha ou durante o restabelecimento de um switch, porta de switch ou link. Uma mudança na topologia de RSTP causa uma transição nas portas de switch apropriadas para o estado de encaminhamento através de reconhecimentos explícitos ou de um processo de proposta e acordo, e sincronização. Você obterá mais informações sobre o processo de proposta e acordo adiante. </p> <p>Com o RSTP, a função de uma porta está separada do estado de uma porta. Por exemplo, uma porta designada pode estar temporariamente no estado de descarte, embora seu estado final seja o de encaminhamento. A figura mostra os três estados de porta possíveis de RSTP: descarte, aprendizagem e encaminhamento. </p> <p><b>Clique no botão Descrições na figura.</b></p> <p>A tabela na figura descreve as características de cada um dos três estados de porta de RSTP. Em todos os estados de porta, uma porta aceita e processa quadros de BPDU.</p> <p><b>Clique no botão Portas de STP e RSTP na figura.</b></p> <p>A tabela na figura compara os estados de porta de STP e RSTP. Lembre-se de como as portas nos estados de porta de bloqueio, escuta e desabilitado do STP não encaminham nenhum quadro. Estes estados de porta foram mesclados no estado de porta de descarte de RSTP. </p></content-text>
</page>
<page type="OneColumn" id="tl1305040602">
<content-media type="InteractiveGraphicRollovers" id="cm4492059859">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040600/tl1305040602/cm4492059859.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040600/tl1305040602/cm4492059859text.xml"/></content-media>
<content-text><p><b>Funções de porta de RSTP</b></p> <p>A função de porta define o objetivo principal de uma porta de switch e como ela trata as estruturas de dados. As funções de porta e estados de porta podem fazer uma transição independentemente da outra. A criação de funções adicionais de porta permite que o RSTP defina uma porta de switch auxiliar antes de uma falha ou mudança de topologia. A porta alternativa vai para o estado de encaminhamento se houver uma falha na porta designada para o segmento.</p> <p><b>Passe o mouse sobre as funções de porta na figura </b>para saber mais sobre cada função de porta de RSTP.</p></content-text>
</page>
<page type="OneColumn" id="tl1305040603">
<content-media type="AnimationPartialScreen" id="cm4927707777">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040600/tl1305040603/cm4927707777.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040600/tl1305040603/cm4927707777text.xml"/></content-media>
<content-text><p><b>Processo de proposta e acordo de RSTP</b></p> <p>No STP do IEEE 802.1D, quando uma porta for selecionada pelo spanning tree para se tornar uma porta designada, ela deverá esperar duas vezes o atraso de encaminhamento antes de fazer a transição da porta para o estado de encaminhamento. O RSTP apressa significativamente o processo do novo cálculo após uma mudança de topologia, uma vez que ele se converge link a link e não depende da expiração dos temporizadores para a transição das portas. A rápida transição para o estado de encaminhamento só pode ser obtida em portas de extremidade e links ponto-a-ponto. No RSTP, esta condição corresponde a uma porta designada no estado de descarte. </p> <p><b>Clique no botão Reproduzir na figura para iniciar a animação.</b></p></content-text>
</page>
</topic>
<topic type="" id="tl1305040700">
<title><content-text>Configurando o Rapid-PVST+</content-text></title>
<page type="OneColumn" id="tl1305040701">
<content-media type="InteractiveGraphicRollovers" id="cm5262070542">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040700/tl1305040701/cm5262070542.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040700/tl1305040701/cm5262070542text.xml"/></content-media>
<content-text><p>O Rapid-PVST+ é uma implementação da Cisco de RSTP. Ele suporta o spanning tree para cada VLAN e é a variante de STP rápida para ser utilizada em redes baseadas na tecnologia da Cisco. A topologia na figura possui duas VLANs: 10 e 20. A configuração final implementará o rapid-PVST+ no switch S1, que é a bridge raiz. </p> <p><b>Diretrizes de configuração</b></p> <p>Convém revisar algumas das diretrizes de configuração de spanning tree. Se você deseja revisar a configuração de spanning tree padrão em um switch Cisco 2960, veja a seção de Configuração de Switch Padrão no início deste capítulo. Não se esqueça destas diretrizes quando for implementar o Rapid-PVST+.</p> <p>Os comandos de rapid-PVST+ controlam a configuração das instâncias de spanning tree da VLAN. Uma instância de spanning tree é criada quando uma interface for atribuída a uma VLAN e é removida quando a última interface for transferida para outra VLAN. Da mesma forma, você pode configurar o switch de STP e os parâmetros de porta antes de uma instância de spanning tree ser criada. Estes parâmetros são aplicados quando são criados um loop e uma instância de spanning tree. Entretanto, certifique-se de que pelo menos um switch em cada loop na VLAN esteja executando o spanning tree, caso contrário poderá ocorrer uma broadcast storm. </p> <p>Um switch Cisco 2960 suporta o PVST+, rapid-PVST+ e MSTP, mas só uma versão pode estar ativa por vez para todas as VLANs. </p><p><b>Clique no botão Comandos de configuração na figura.</b></p> <p>A figura mostra a sintaxe de comando do Cisco IOS necessária para configurar o rapid-PVST+ em um switch da Cisco. Existem outros parâmetros que também podem ser configurados.</p> <p><b>Nota:</b> Se você conectar uma porta configurada com o comando ponto-a-ponto de tipo de link spanning tree a uma porta remota através de um link ponto-a-ponto e a porta local se tornar uma porta designada, o switch negociará com a porta remota e mudará rapidamente a porta local para o estado de encaminhamento. </p> <p><b>Nota:</b> Quando uma porta é configurada com o comando de protocolos detectados de spanning tree e esta porta for conectada a uma porta em um switch IEEE 802.1D herdado, o software IOS Cisco reiniciará o processo de migração de protocolo em todo o switch. Esta etapa é opcional, entretanto recomenda-se uma prática padrão, mesmo se o switch designado detectar que este switch está executando o rapid-PVST+. </p> <p>Para obter detalhes completos sobre todos os parâmetros associados aos comando específicos do Cisco IOS, visite: <content-link target="http://www.cisco.com/en/US/docs/switches/lan/catalyst2960/software/release/12.2_37_se/command/reference/cli3.html" type="external">http://www.cisco.com/en/US/docs/switches/lan/catalyst2960/software/release/12.2_37_se/command/reference/cli3.html</content-link> (em inglês).</p> <p><b>Clique no botão Exemplo de configuração na figura.</b></p> <p>O exemplo de configuração mostra a habilitação dos comandos do rapid-PVST+ no switch S1.</p> <p><b>Clique no botão Verificar na figura.</b></p> <p>O comando <span class="cmd"><b>show spanning-tree vlan </b><i>vlan-id</i></span> mostra a configuração da VLAN 10 no switch S1. Observe que a prioridade de BID é definida a 4096. O BID foi definido utilizando o comando <span class="cmd"><b>spanning-tree vlan </b><i>vlan-id</i><b> priority </b><i>priority-number</i></span>.</p> <p><b>Clique no botão </b><span class="cmd"><b>show run</b></span><b> na figura.</b></p> <p>Neste exemplo, o comando <span class="cmd"><b>show running-configuration</b></span> foi utilizado para verificar a configuração do rapid-PVST+ em S1. </p></content-text>
</page>
</topic>
<topic type="" id="tl1305040800">
<title><content-text>Design de STP para evitar problemas</content-text></title>
<page type="OneColumn" id="tl1305040801">
<content-media type="StaticGraphic" id="cm3090994125">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040800/tl1305040801/cm3090994125.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040800/tl1305040801/cm3090994125text.xml"/></content-media>
<content-text><p><b>Saiba onde está a raiz</b></p> <p>Você sabe agora que a função primária do STA é interromper os loops criados pelos links redundantes nas redes de bridge. O STP opera na Camada 2 do modelo OSI. O STP pode falhar em alguns casos específicos. Solucionar o problema pode ser muito difícil e depende do design da rede. Esta é a razão pela qual recomenda-se que você realize a parte mais importante da solução de problemas antes de eles ocorrerem.</p> <p>É muito comum as informações sobre o local da rota não estarem disponíveis no momento da solução de problemas. Não deixe que o STP decida qual bridge é a raiz. Para cada VLAN, você pode geralmente identificar qual switch pode servir melhor como raiz. No geral, escolha uma bridge avançada no meio da rede. Se você colocar a bridge raiz no centro da rede com uma conexão direta com os servidores e roteadores, reduzirá a distância média dos clientes para os servidores e roteadores.</p> <p>A figura mostra:</p> <p><ul><li>Se o switch S2 for a raiz, o link de S1 para S3 será bloqueado em S1 ou S3. Neste caso, os hosts que se conectam ao switch S2 podem acessar o servidor e o roteador em dois saltos. Os hosts que se conectam à bridge S3 podem acessar o servidor e o roteador em três saltos. A distância média é dois saltos e meio. </li><li> Se o switch S1 for a raiz, o roteador e o servidor poderão ser alcançados em dois saltos para ambos os hosts que se conectam em S2 e S3. A distância média é agora de dois saltos. </li></ul></p> <p> </p> <p>A lógica por trás deste simples exemplo vale para topologias mais complexas. </p> <p><b>Nota:</b> Para cada VLAN, configure a bridge raiz e a bridge raiz de backup que utilizar as prioridades mais baixas.</p></content-text>
</page>
<page type="OneColumn" id="tl1305040802">
<content-media type="InteractiveGraphicRollovers" id="cm8796978135">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040800/tl1305040802/cm8796978135.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040800/tl1305040802/cm8796978135text.xml"/></content-media>
<content-text><p>Para que a resolução de problemas do STP fique mais fácil, planeje a organização dos seus links redundantes. Em redes não-hierárquicas, você deverá ajustar o parâmetro de custo do STP para decidir quais portas bloquear. Entretanto, este ajuste normalmente não é necessário caso você tenha um design hierárquico e uma bridge raiz em um bom local.</p> <p><b>Nota:</b> Para cada VLAN, saiba quais portas devem ser bloqueadas na rede estável. Obtenha um diagrama de rede que mostre claramente cada loop físico na rede e quais portas bloqueadas interrompem os loops.</p> <p>Conhecer o local dos links redundantes ajuda a identificar um loop de bridging acidental e sua causa. Além disso, conhecer o local das portas bloqueadas permite que você determine o local do erro.</p> <p><b>Diminua o número de portas bloqueadas</b> </p> <p>A única ação crítica desempenhada pelo STP é o bloqueio de portas. Uma única porta de bloqueio que faz a transição incorreta para o encaminhamento pode afetar de modo negativo uma grande parte da rede. Uma boa maneira de limitar o risco inerente no uso de STP é reduzir o máximo do número de portas bloqueadas possível.</p> <p><b>Corte de VTP</b></p> <p>Você não precisa de mais de dois links redundantes entre dois nós em uma rede comutada. Porém, o tipo de configuração mostrado na figura é comum. Os switches de distribuição são anexados duplamente a dois switches de núcleo, switches C1 e C2. Os usuários nos switches S1 e S2 que se conectam a switches de distribuição estão somente em um subconjunto de VLANs disponíveis na rede. Na figura, todos os usuários que se conectam ao switch D1 estão na VLAN 20; o switch D2 conecta os usuários somente na VLAN 30. Por padrão, os troncos levam todas as VLANs definidas no domínio de VTP. Somente o switch D1 recebe do tráfego de broadcast e multicast desnecessário para a VLAN 20, mas ele também bloqueia uma de suas portas para a VLAN 30. Existem três caminhos redundantes entre o switch de núcleo C1 e o switch de núcleo C2. Esta redundância resulta em mais portas bloqueadas e em uma probabilidade mais alta de loops.</p> <p><b>Nota:</b> Corte todas as VLANs de seu tronco que não sejam necessárias.</p> <p><b>Clique no botão Corte Manual na figura.</b></p> <p><b>Corte manual</b></p> <p>O corte de VTP pode ajudar, mas este recurso não é necessário no núcleo da rede. Nesta figura, somente uma VLAN de acesso é utilizada para conectar os switches de distribuição ao núcleo. Neste design, somente uma porta é bloqueada por VLAN. Além disso, com este design, você pode remover todos os links redundantes em apenas uma etapa se você desligar C1 ou C2.</p></content-text>
</page>
<page type="OneColumn" id="tl1305040803">
<content-media type="StaticGraphic" id="cm1043369401">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040800/tl1305040803/cm1043369401.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040800/tl1305040803/cm1043369401text.xml"/></content-media>
<content-text><p><b>Utilize a comutação da camada 3</b></p> <p>A comutação da camada 3 significa rotear aproximadamente na velocidade da comutação. Um roteador executa duas funções principais:</p> <p><ul><li>Ele cria uma tabela de encaminhamento. O roteador geralmente troca informações com pontos por meio de protocolos de roteamento.</li><li>Ele recebe os pacotes e os encaminha à interface correta com base no endereço de destino.</li></ul></p> <p>Os switches de Camada 3 da Cisco agora são capazes de desempenhar esta segunda função, na mesma velocidade que a função de comutação da Camada 2. Na figura:</p> <p><ul><li>Não há nenhuma penalidade de velocidade com o <content-link target="{F6C44F67-4253-4668-B1CB-79DDD64C8C16}" type="glossary">salto</content-link> de roteamento e um segmento adicional entre C1 e C2.</li><li>O switch de núcleo C1 e o switch de núcleo C2 são switches de Camada 3. A VLAN 20 e VLAN 30 não estão mais interligadas entre C1 e C2, assim não há nenhuma possibilidade de loop.</li></ul></p> <p>A redundância ainda acontece, contando com os protocolos de roteamento de Camada 3. O design garante uma convergência que chega a ser mais rápida que a convergência com STP.</p> <p><ul><li>O STP não bloqueia mais nenhuma porta, assim não há nenhum potencial para um loop de bridging.</li><li>Deixar a VLAN pela comutação da Camada 3 é tão rápido quanto o bridging dentro da VLAN.</li></ul></p></content-text>
</page>
<page type="OneColumn" id="tl1305040804">
<content-media type="StaticGraphic" id="cm4295140158">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040800/tl1305040804/cm4295140158.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040800/tl1305040804/cm4295140158text.xml"/></content-media>
<content-text><p><b>Pontos finais </b></p> <p><b>Mantenha o STP mesmo se ele for desnecessário </b></p> <p>Supondo que você tenha removido todas as portas bloqueadas da rede e que não tenha qualquer redundância física, aconselha-se que você não desabilite o STP.</p> <p>O STP geralmente não utiliza muito o processador. A comutação de pacotes não envolve a CPU na maioria dos switches da Cisco. Além disso, os poucos BPDUs que são enviados em cada link não reduzem a largura de banda disponível de modo significativo. Entretanto, se um técnico cometer um erro de conexão em um patch panel e criar acidentalmente um loop, a rede será prejudicada. No geral, não compensa desabilitar o STP em uma rede comutada. </p> <p><b>Mantenha o tráfego fora da VLAN Administrativa e não deixe que uma única VLAN ocupe toda a rede </b></p> <p>Um switch da Cisco geralmente possui um único endereço IP que se liga a uma VLAN, conhecido como a VLAN administrativa. Nesta VLAN, o switch se comporta como um host IP genérico. Em particular, todos os pacotes de broadcast e multicast são encaminhados à CPU. Uma alta taxa de tráfego de broadcast ou multicast na VLAN administrativa pode afetar de modo negativo a CPU e sua capacidade de processar BPDUs essenciais. Portanto, mantenha o tráfego do usuário fora da VLAN administrativa.</p> <p>Até recentemente, não havia nenhum modo de remover a VLAN 1 de um tronco em uma implementação da Cisco. A VLAN 1 geralmente serve como uma VLAN administrativa, onde todos os switches são acessíveis na mesma sub-rede de IP. Embora seja útil, esta configuração pode ser perigosa porque um loop de bridging na VLAN 1 afeta todos os troncos, o que pode derrubar toda a rede. Claro que o mesmo problema existe, não importa qual VLAN você utiliza. Tente segmentar os domínios de bridging utilizando os switches de Camada 3 de alta velocidade. </p> <p><b>Nota:</b> A partir do Software IOS Cisco Release 12.1 (11b)E, você pode remover aVLAN 1 dos troncos. A VLAN 1 ainda existe, mas ela bloqueia o tráfego, impedindo qualquer possibilidade de loop.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305040900">
<title><content-text>Identificação e solução de problemas de operação STP</content-text></title>
<page type="OneColumn" id="tl1305040901">
<content-media type="AnimationPartialScreen" id="cm4756369660">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040900/tl1305040901/cm4756369660.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040900/tl1305040901/cm4756369660text.xml"/></content-media>
<content-text><p><b>Falha de switch ou link</b></p> <p>Na animação você vê que, quando uma porta falha em uma rede configurada com o STP, o resultado pode ser uma broadcast storm.</p> <p>No estado inicial da falha do STP, o switch S3 possui um BID inferior ao de S2. Conseqüentemente, a porta designada entre S3 e S2 é a porta F0/1 no switch S3. Considera-se que o switch S3 possui uma "BPDU melhor" que o switch S2.</p> <p><b>Clique no botão Reproduzir na figura para ver a falha do STP.</b></p></content-text>
</page>
<page type="OneColumn" id="tl1305040902">
<content-media type="StaticGraphic" id="cm1702814491">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040900/tl1305040902/cm1702814491.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040900/tl1305040902/cm1702814491text.xml"/></content-media>
<content-text><p><b>Solucionar uma falha </b></p> <p>Infelizmente, não há nenhum procedimento sistemático para solucionar um problema de STP. Esta seção resume algumas das medidas que estão disponíveis para você. A maioria das etapas se aplicam à solução de loops de bridging em geral. Você pode utilizar uma abordagem mais convencional para identificar outras falhas de STP que levam a uma perda de conectividade. Por exemplo, você pode explorar o caminho que é levado pelo tráfego que está passando por um problema.</p> <p><b>Nota:</b> O acesso dentro da banda pode não ficar disponível durante um loop de bridging. Por exemplo, durante uma broadcast storm, talvez você não seja capaz realizar um Telnet para os dispositivos de infra-estrutura. Portanto, a conectividade <content-link target="{C0B9FF31-9120-41F8-8EC3-6EB44A9BF039}" type="glossary">fora da banda</content-link>, como o acesso de console, pode ser necessária.</p> <p>Antes de você solucionar problemas de um loop de bridging, é necessário saber pelo menos os seguintes itens:</p> <p><ul><li>Topologia da rede de bridge</li><li>Localização da bridge raiz</li><li>Localização das portas bloqueadas e dos links redundantes</li></ul></p> <p>Este conhecimento é essencial. Para saber o que corrigir na rede, você precisa saber como a rede fica quando ela funciona corretamente. A maioria das etapas de solução de problemas simplesmente utilizam os comandos <span class="cmd"><b>show</b></span> para tentar identificar as condições de erro. O conhecimento da rede ajuda a focalizar nas portas essenciais nos principais dispositivos. </p> <p>O resto deste tópico observa brevemente dois problemas de spanning tree comuns, um erro de configuração de PortFast e problemas de diâmetro de rede. Para obter mais informações sobre outros problemas de STP, visite: <content-link target="http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a00800951ac.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a00800951ac.shtml</content-link> (em inglês).</p></content-text>
</page>
<page type="OneColumn" id="tl1305040903">
<content-media type="StaticGraphic" id="cm4211036363">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040900/tl1305040903/cm4211036363.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040900/tl1305040903/cm4211036363text.xml"/></content-media>
<content-text><p><b>Erro de configuração de PortFast</b></p> <p>Geralmente você habilita o PortFast somente para uma porta ou interface que se conecta a um host. Quando o link surgir nesta porta, a bridge pula as primeiras fases do STA e faz uma transição direta para o modo de encaminhamento.</p> <p><b>Cuidado:</b> Não utilize o PortFast em portas de switch ou interfaces que se conectam a outros switches, hubs ou roteadores. Caso contrário, você pode criar um loop de rede.</p> <p>Neste exemplo, a porta F0/1 no switch S1 já está encaminhando. A porta F0/2 foi configurada incorretamente com o recurso do PortFast. Portanto, quando uma segunda conexão de switch S2 é conectada a F0/2 em S1, a porta faz a transição automaticamente para o modo de encaminhamento e cria um loop.</p> <p>Eventualmente, um dos switches encaminhará um BPDU e um destes switches fará a transição de uma porta para o modo de bloqueio.</p> <p>Porém, há um problema com este tipo de loop passageiro. Se o tráfego com loops for muito intenso, o switch pode ter dificuldade para transmitir com sucesso o BPDU que interrompe o loop. Este problema pode atrasar a convergência de modo considerável ou, em alguns casos extremos, pode derrubar a rede de fato.</p> <p>Mesmo com uma configuração de PortFast, a porta ou interface ainda participa de STP. Se um switch com uma prioridade de bridge inferior que a da bridge raiz ativa atual for anexado a uma porta ou interface configurada por PortFast, ele poderá ser escolhido a bridge raiz. Esta alteração de bridge raiz pode afetar a topologia de STP ativa de modo negativo e pode fazer com que a rede não seja mais ideal. Para impedir esta situação, a maioria dos switches Catalyst que executam o software IOS Cisco possuem um recurso chamado proteção de BPDU. A proteção de BPDU desabilita uma porta ou interface configurada por PortFast se a porta ou interface receber um BPDU.</p> <p>Para obter mais informações sobre como utilizar o PortFast nos switches que executam o software IOS Cisco, consulte o documento "Utilizando o PortFast e outros comandos para corrigir atrasos de conectividade de inicialização da estação de trabalho", disponível em: <content-link target="http://www.cisco.com/en/US/products/hw/switches/ps700/products_tech_note09186a00800b1500.shtml" type="external">http://www.cisco.com/en/US/products/hw/switches/ps700/products_tech_note09186a00800b1500.shtml</content-link>.</p> <p>Para obter mais informações sobre o uso do recurso de proteção de BPDU em switches que executam o software IOS Cisco, visite: <content-link target="http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a008009482f.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a008009482f.shtml</content-link> (em inglês).</p></content-text>
</page>
<page type="OneColumn" id="tl1305040904">
<content-media type="StaticGraphic" id="cm1369055914">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040900/tl1305040904/cm1369055914.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040900/tl1305040904/cm1369055914text.xml"/></content-media>
<content-text><p><b>Problemas de diâmetro de rede</b></p> <p>Outro problema que não é muito conhecido está relacionado com o diâmetro da rede comutada. Os valores padrão conservadores para os temporizadores de STP impõem um diâmetro de rede máximo de sete. Na figura, este design cria um diâmetro de rede de oito. O diâmetro de rede máximo restringe a distância que os switches podem estar um do outro na rede. Neste caso, dois switches distintos não podem estar mais longe do que a sete saltos de distância. Parte desta restrição vem do campo idade que os BPDUs carregam.</p> <p>Quando um BPDU propaga a partir da bridge raiz até as folhas da árvore, o campo de validade aumenta a cada vez que o BPDU vai através de um switch. Eventualmente, o switch descarta o BPDU quando o campo de idade estiver além da idade máxima. Se a raiz estiver muito longe de alguns switches da rede, o BPDUs será descartado. Este problema afeta a convergência do spanning tree.</p> <p>Tome um cuidado especial se você planeja alterar o valor padrão dos temporizadores de STP. Pode ser perigoso se você tentar obter uma convergência mais rápida deste modo. Uma mudança de temporizador de STP causa um impacto no diâmetro da rede e na estabilidade do STP. Você pode alterar a prioridade de switch para selecionar a bridge raiz e alterar o custo de porta ou prioridade de parâmetro para controlar a redundância ou balanceamento de carga.</p></content-text>
</page>
<page type="FullScreen" id="tl1305040905">

<content-media type="ActivityCustom" id="cm1056323676">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040900/tl1305040905/cm1056323676.swf"  mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040900/tl1305040905/cm1056323676text.xml"/></content-media>
<content-text></content-text>
</page>
</topic>
</section>
<section type="" id="tl1305050000">
<title><content-text>Laboratórios do capítulo</content-text></title>
<topic type="" id="tl1305050100">
<title><content-text>Protocolo spanning tree básico</content-text></title>
<page type="OneColumn" id="tl1305050101">
<content-media type="ActivityLab" id="cm7380097902">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305050000/tl1305050100/tl1305050101/cm7380097902/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305050000/tl1305050100/tl1305050101/cm7380097902/icontext.xml"/></content-media>
<content-text><p>Uma das metas de design de qualquer rede é a redundância. Se um link de rede falhar, existe um link de backup que pode comutar imediatamente o tráfego que estava passando anteriormente pelo link? A redundância física na rede é necessária para impedir quedas ou indisponibilidade de rede. Entretanto, esta mesma redundância física na rede cria um problema lógico. Se houver uma redundância física na rede de switch, como você impede a ocorrência de loops de Camada 2? O Protocolo Spanning Tree (STP) foi criado para resolver este problema. Neste laboratório, aprenderemos como configurar o STP.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305050200">
<title><content-text>Protocolo spanning tree avançado</content-text></title>
<page type="OneColumn" id="tl1305050201">
<content-media type="ActivityLab" id="cm4910421381">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305050000/tl1305050200/tl1305050201/cm4910421381/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305050000/tl1305050200/tl1305050201/cm4910421381/icontext.xml"/></content-media>
<content-text><p>É fundamental conhecer profundamente como configurar o Protocolo Spanning Tree para implementar redes comutadas. Este laboratório proporciona uma prática adicional para esta configuração.</p></content-text>
</page>
<page type="OneColumn" id="tl1305050202">
<content-media type="ActivityPKA" id="cm2035957299">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305050000/tl1305050200/tl1305050202/cm2035957299/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305050000/tl1305050200/tl1305050202/cm2035957299/icontext.xml"/></content-media>
<content-text><p>Esta atividade é uma variação do laboratório 5.5.2. O Packet Tracer pode não suportar todas as tarefas especificadas no laboratório prático. Esta atividade não deve ser considerada equivalente à conclusão do laboratório prático. O Packet Tracer não substitui um experimento em laboratório prático com equipamentos reais.</p> <p>São fornecidas instruções detalhadas na atividade, bem como no link do PDF abaixo.</p> <p><content-link target="E3_PTAct_5_5_2.pdf" type="internalfile">Instruções da atividade (PDF)</content-link></p> <p><b>Clique no ícone do Packet Tracer para obter mais detalhes.</b></p></content-text>
</page>
</topic>
<topic type="" id="tl1305050300">
<title><content-text>Identificação e solução de problemas do Protocolo spanning tree</content-text></title>
<page type="OneColumn" id="tl1305050301">
<content-media type="ActivityLab" id="cm8824744930">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305050000/tl1305050300/tl1305050301/cm8824744930/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305050000/tl1305050300/tl1305050301/cm8824744930/icontext.xml"/></content-media>
<content-text><p>Você é responsável pela operação da rede local comutada redundante mostrada no diagrama de topologia. Você e seus usuários têm observado um aumento da latência durante as horas de uso de pico e sua análise identifica troncos congestionados. Você reconhece que, dos seis troncos configurados, somente três estão encaminhando pacotes na configuração de STP padrão atualmente em execução. A solução para esse problema exige o uso mais efetivo dos troncos disponíveis. O recurso PVST+ dos switches da Cisco proporciona a flexibilidade necessária para distribuir o tráfego entre switches utilizando os seis troncos.</p> <p>Este laboratório será concluído quando todos os troncos com fio estiverem transmitindo tráfego e todos os três switches estiverem participando do balanceamento de carga por VLAN para as três VLANs de usuário. </p></content-text>
</page>
<page type="OneColumn" id="tl1305050302">
<content-media type="ActivityPKA" id="cm9675636910">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305050000/tl1305050300/tl1305050302/cm9675636910/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305050000/tl1305050300/tl1305050302/cm9675636910/icontext.xml"/></content-media>
<content-text><p>Esta atividade é uma variação do laboratório 5.5.3. O Packet Tracer pode não suportar todas as tarefas especificadas no laboratório prático. Esta atividade não deve ser considerada equivalente à conclusão do laboratório prático. O Packet Tracer não substitui um experimento em laboratório prático com equipamentos reais.</p> <p>São fornecidas instruções detalhadas na atividade, bem como no link do PDF abaixo.</p> <p><content-link target="E3_PTAct_5_5_3.pdf" type="internalfile">Instruções da atividade (PDF)</content-link></p> <p><b>Clique no ícone do Packet Tracer para obter mais detalhes.</b></p></content-text>
</page>
</topic>
</section>
<section type="ChapterSummary" id="tl1305060000">
<title><content-text>Resumo do capítulo</content-text></title>
<topic type="" id="tl1305060100">
<title><content-text>Resumo</content-text></title>
<page type="OneColumn" id="tl1305060101">
<content-media type="ChapterSummary" id="cm1170567563">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305060000/tl1305060100/tl1305060101/cm1170567563.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305060000/tl1305060100/tl1305060101/cm1170567563text.xml"/></content-media>
<content-text><p>A implementação da redundância em uma rede hierárquica introduz loops físicos que resultam em problemas de Camada 2 que afetam a disponibilidade da rede. O protocolo spanning tree foi desenvolvido para impedir problemas resultantes dos loops físicos introduzidos para aprimorar a redundância. Este protocolo utiliza o algoritmo spanning tree para computar uma topologia lógica sem loops para um domínio de broadcast. </p> <p>O processo spanning tree utiliza estados de porta e temporizadores diferentes para evitar logicamente os loops construindo uma topologia sem loops. A determinação da topologia spanning tree é construída em termos de distância da bridge raiz. A distância é determinada pela troca de BPDUs e algoritmo spanning tree. No processo, as funções de porta são determinadas: portas designadas, portas não-designadas eportas raiz.</p> <p>Utilizar o protocolo spanning tree IEEE 802.1D original envolve um tempo de convergência de até 50 segundos. Este atraso é inaceitável em redes comutadas modernas, assim o protocolo spanning tree rápido IEEE 802.1w foi desenvolvido. A implementação do IEEE 802.1D por VLAN da Cisco é chamada PVST+ e a implementação do protocolo spanning tree rápido da Cisco é chamada rapid-PVST+. O RSTP reduz o tempo de convergência para aproximadamente 6 segundos ou menos.</p> <p>Nós discutimos os tipos de link ponto a ponto e compartilhado com RSTP, bem como as portas de extremidade. Nós também discutimos os novos conceitos de portas alternativas e portas de backup utilizados com o RSTP.</p> <p>O rapid-PVST+ é a implementação de protocolo spanning tree preferida utilizada em uma rede comutada que utiliza os switches Cisco Catalyst.</p></content-text>
</page>
<page type="FullScreen" id="tl1305060102">
<content-media type="StaticGraphic" id="cm3770022391">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305060000/tl1305060100/tl1305060102/cm3770022391.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305060000/tl1305060100/tl1305060102/cm3770022391text.xml"/></content-media>
<content-text></content-text>
</page>
<page type="OneColumn" id="tl1305060103">
<content-media type="ActivityPKA" id="cm5475272455">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305060000/tl1305060100/tl1305060103/cm5475272455/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305060000/tl1305060100/tl1305060103/cm5475272455/icontext.xml"/></content-media>
<content-text><p>Nesta atividade, você irá configurar uma rede redundante com VTP, VLANs e STP. Além disso, você criará um esquema de endereçamento com base em requisitos de usuário. As VLANs desta atividade são diferentes das que você visualizou nos capítulos anteriores. É importante que você saiba que a VLAN de gerenciamento e padrão não precisa ser a 99. Ele pode ser qualquer número escolhido. Portanto, nós utilizamos a VLAN 5 nesta atividade.</p> <p>São fornecidas instruções detalhadas na atividade, bem como no link do PDF abaixo.</p> <p><content-link target="E3_PTAct_5_6_1.pdf" type="internalfile">Instruções da atividade (PDF)</content-link></p> <p><b>Clique no ícone do Packet Tracer para obter mais detalhes.</b></p></content-text>
</page>
</topic>
</section>
<section type="ChapterQuiz" id="tl1305070000">
<title><content-text>Teste do capítulo</content-text></title>
<topic type="" id="tl1305070100">
<title><content-text>Teste do capítulo</content-text></title>
<page type="FullScreen" id="tl1305070101">
<content-media type="ChapterQuiz" id="cm3237637239">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305070000/tl1305070100/tl1305070101/cm3237637239/" mime="" scale="true" type="directory" width="100%" height="100%" external="tl1305000000/tl1305070000/tl1305070100/tl1305070101/cm3237637239/icontext.xml"/></content-media>
<content-text><p>Teste do capítulo</p></content-text>
</page>
</topic>
</section>
</chapter>
